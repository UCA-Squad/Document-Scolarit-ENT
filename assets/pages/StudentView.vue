<template>
  <div v-if="this.docs !== null && Object.keys(docs.data).length > 0" class="container-lg">

    <div class="mt-2 mb-2 row">
      <h4>Documents de scolarité</h4>
      <h5>{{ this.docs.student.nom }} {{ this.docs.student.prenom }} ({{ this.docs.student.numero }})</h5>
    </div>

    <div class="accordion" id="accordionPanelsStayOpenExample">
      <div v-for="(year, index) in Object.keys(docs.data).reverse()" class="accordion-item mt-2">
        <h2 class="accordion-header" :id="'panelsStayOpen-heading' + year">
          <button :class="'accordion-button' + (index > 0 ? ' collapsed' : '')" type="button" data-bs-toggle="collapse"
                  :data-bs-target="'#panelsStayOpen-collapse' + year" :aria-expanded="index === 0"
                  :aria-controls="'panelsStayOpen-collapse' + year">
            {{ year }}
          </button>
        </h2>
        <div :id="'panelsStayOpen-collapse' + year"
             :class="'accordion-collapse collapse' + (index === 0 ? ' show' : '')"
             :aria-labelledby="'panelsStayOpen-heading' + year">
          <div class="accordion-body">
            <div class="row">
              <div :class="'col-12 col-lg-6 ' + (docs.data[year].rn === undefined ? 'collapse' : '')">
                <h6><strong>Relevés de notes</strong></h6>
                <ul>
                  <li v-for="rn in docs.data[year].rn"><a
                      :href="WebService().getDownloadURL(0) + this.num + '/'+ rn.index"
                      target="_blank">{{ rn.name }}</a></li>
                </ul>
              </div>
              <div :class="'col-12 col-lg-6 ' + (docs.data[year].attest === undefined ? 'collapse' : '')">
                <h6><strong>Attestations de réussite</strong></h6>
                <ul>
                  <li v-for="attest in docs.data[year].attest"><a
                      :href="WebService().getDownloadURL(1) + this.num + '/'+ attest.index"
                      target="_blank">{{ attest.name }}</a></li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>

  <div v-else class="container">

    <div class="mt-2 mb-2 row">
      <h4>Documents de scolarité</h4>
      <h5 v-if="this.docs !== null">{{ this.docs.student.nom }} {{ this.docs.student.prenom }}
        ({{ this.docs.student.numero }})</h5>
    </div>

    <div class="alert alert-warning m-5 text-center">Aucun document vous concernant n'a été déposé par votre service scolarité</div>
  </div>
</template>

<script>
import WebService from "../WebService";
import {user} from "../user";

export default {
  name: "StudentView",
  data() {
    return {
      docs: null,
      num: 0
    }
  },
  methods: {
    WebService() {
      return WebService
    },
    fetchDocs() {
      WebService.getStudentDocs(this.num).then(response => {
        this.docs = response.data;
        // console.log(this.docs);
      }).catch(error => {
        console.log("Error fetching docs");
      })
    },
  },
  mounted() {
    if (user.isEtudiant())
      this.num = user.numero;
    else
      this.num = this.$route.params.num;
    this.fetchDocs();
  }
}
</script>


<style scoped>

</style>
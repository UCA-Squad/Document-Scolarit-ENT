/*! For license information please see app.5f61fe8a.js.LICENSE.txt */
"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[524],{5870:(e,t,n)=>{n(9432),n(6918),n(2945),n(5815),n(4979),n(9739),n(6099),n(3362),n(1392);var r=n(1425);var o=function(e){return(0,r.Qi)("data-v-78620c63"),e=e(),(0,r.jt)(),e},a={ref:"depot-nav",class:"navbar navbar-expand-lg navbar-dark bg-primary",style:{"box-shadow":"0px 5px 10px 0px #9c9c9c",height:"50px"}},s={class:"container-fluid",style:{margin:"0 5px",padding:"0"}},i={class:"d-flex align-items-center gap-2 text-white",style:{margin:"0 5px",padding:"0 3px"}},l=o((function(){return(0,r.Lk)("span",{type:"button",id:"btnMenuEnt",class:"mdi mdi-dots-grid",style:{"font-size":"28px","margin-right":"2px"}},null,-1)})),u={key:1,class:"navbar-brand",href:"#"},c={key:0,class:"navbar-toggler",type:"button","data-bs-toggle":"collapse","data-bs-target":"#navbarSupportedContent","aria-controls":"navbarSupportedContent","aria-expanded":"false","aria-label":"Toggle navigation"},d=[o((function(){return(0,r.Lk)("span",{class:"navbar-toggler-icon"},null,-1)}))],p={class:"collapse navbar-collapse",id:"navbarSupportedContent"},m={class:"navbar-nav me-auto mb-2 mb-lg-0"},f={key:0,class:"nav-item"},h={key:1,class:"nav-item dropdown"},v=o((function(){return(0,r.Lk)("a",{class:"nav-link dropdown-toggle",href:"#",role:"button","data-bs-toggle":"dropdown","aria-expanded":"false"}," Relevés ",-1)})),b={class:"dropdown-menu"},g={key:2,class:"nav-item dropdown"},y=o((function(){return(0,r.Lk)("a",{class:"nav-link dropdown-toggle",href:"#",role:"button","data-bs-toggle":"dropdown","aria-expanded":"false"}," Attestations ",-1)})),k={class:"dropdown-menu"},L={key:3,class:"nav-item"};n(2010),n(4423),n(1699);var w=(0,r.Kh)({name:"",encryptedName:"",roles:[],numero:"",setName:function(e){this.name=e},setEncryptedName:function(e){this.encryptedName=e},setRoles:function(e){this.roles=e},setNumero:function(e){this.numero=e},asRole:function(e){return this.roles.includes(e)},isAdmin:function(){return this.asRole("ROLE_ADMIN")},isEtudiant:function(){return this.asRole("ROLE_ETUDIANT")},isAnonym:function(){return this.asRole("ROLE_ANONYMOUS")},isScola:function(){return this.isAdmin()||this.asRole("ROLE_SCOLA")}});const C={name:"Header",data:function(){return{navHeight:0}},computed:{user:function(){return w}},props:{url_login:String,url_logout:String},methods:{},mounted:function(){this.navHeight=this.$refs["depot-nav"].offsetHeight+1}};var S=n(6262);const x={name:"App",components:{Header:(0,S.A)(C,[["render",function(e,t,n,o,w,C){var S=(0,r.g2)("router-link"),x=(0,r.g2)("uca-menu");return(0,r.uX)(),(0,r.CE)(r.FK,null,[(0,r.Lk)("nav",a,[(0,r.Lk)("div",s,[(0,r.Lk)("div",i,[l,C.user.isScola()?((0,r.uX)(),(0,r.Wv)(S,{key:0,class:"text-decoration-none text-white",to:"/scola"},{default:(0,r.k6)((function(){return[(0,r.eW)("Doc Scola")]})),_:1})):((0,r.uX)(),(0,r.CE)("a",u,"Doc Scola"))]),C.user.isScola()?((0,r.uX)(),(0,r.CE)("button",c,d)):(0,r.Q3)("v-if",!0),(0,r.Lk)("div",p,[(0,r.Lk)("ul",m,[C.user.isAdmin()?((0,r.uX)(),(0,r.CE)("li",f,[(0,r.bF)(S,{"active-class":"active",class:"nav-link","aria-current":"page",to:"/users"},{default:(0,r.k6)((function(){return[(0,r.eW)("Utilisateurs ")]})),_:1})])):(0,r.Q3)("v-if",!0),C.user.isScola()?((0,r.uX)(),(0,r.CE)("li",h,[v,(0,r.Lk)("ul",b,[(0,r.Lk)("li",null,[(0,r.bF)(S,{class:"dropdown-item",to:"/scola/import/rn"},{default:(0,r.k6)((function(){return[(0,r.eW)("Import")]})),_:1})]),(0,r.Lk)("li",null,[(0,r.bF)(S,{class:"dropdown-item",to:"/scola/monitoring/rn"},{default:(0,r.k6)((function(){return[(0,r.eW)("Suivi")]})),_:1})])])])):(0,r.Q3)("v-if",!0),C.user.isScola()?((0,r.uX)(),(0,r.CE)("li",g,[y,(0,r.Lk)("ul",k,[(0,r.Lk)("li",null,[(0,r.bF)(S,{class:"dropdown-item",to:"/scola/import/attest"},{default:(0,r.k6)((function(){return[(0,r.eW)("Import")]})),_:1})]),(0,r.Lk)("li",null,[(0,r.bF)(S,{class:"dropdown-item",to:"/scola/monitoring/attest"},{default:(0,r.k6)((function(){return[(0,r.eW)("Suivi")]})),_:1})])])])):(0,r.Q3)("v-if",!0),C.user.isScola()?((0,r.uX)(),(0,r.CE)("li",L,[(0,r.bF)(S,{"active-class":"active",class:"nav-link","aria-current":"page",to:"/scola/search"},{default:(0,r.k6)((function(){return[(0,r.eW)("Recherche étudiant ")]})),_:1})])):(0,r.Q3)("v-if",!0)])])])],512),(0,r.bF)(x,{"data-opener":"btnMenuEnt","data-opener-class":"text-info","data-toggle-outside":"true","data-top":w.navHeight,"data-client":"DOCSCOLA","data-connected":C.user.encryptedName,"data-path-login":n.url_login,"data-path-logout":n.url_logout},null,8,["data-top","data-connected","data-path-login","data-path-logout"])],64)}],["__scopeId","data-v-78620c63"]])},props:{url_login:String,url_logout:String}},D=(0,S.A)(x,[["render",function(e,t,n,o,a,s){var i=(0,r.g2)("Header"),l=(0,r.g2)("router-view");return(0,r.uX)(),(0,r.CE)(r.FK,null,[(0,r.bF)(i,{url_login:n.url_login,url_logout:n.url_logout},null,8,["url_login","url_logout"]),(0,r.bF)(l)],64)}]]);var E=n(9351),R={class:"container"},_=(0,r.Lk)("div",{class:"row justify-content-md-center"},[(0,r.Lk)("h2",null,"Gestion des documents de scolarité")],-1),A={style:{"margin-top":"40px"},class:"row"},U={class:"col-sm"},G={class:"card text-white bg-primary"},T=(0,r.Lk)("div",{class:"card-header"},"Relevés de notes",-1),N={class:"card-body"},F={style:{"text-align":"center"}},M={style:{"text-align":"center"}},O={class:"col-sm"},X={class:"card text-white bg-primary"},j=(0,r.Lk)("div",{class:"card-header"},"Attestations de réussite",-1),I={class:"card-body"},P={style:{"text-align":"center"}},B={style:{"text-align":"center"}};const W={name:"HomeScola"},Q=(0,S.A)(W,[["render",function(e,t,n,o,a,s){var i=(0,r.g2)("router-link");return(0,r.uX)(),(0,r.CE)("div",R,[_,(0,r.Lk)("div",A,[(0,r.Lk)("div",U,[(0,r.Lk)("div",G,[T,(0,r.Lk)("div",N,[(0,r.Lk)("h2",F,[(0,r.bF)(i,{class:"btn btn-secondary",to:"/scola/import/rn"},{default:(0,r.k6)((function(){return[(0,r.eW)("Importer des relevés de notes ")]})),_:1})]),(0,r.Lk)("h2",M,[(0,r.bF)(i,{class:"btn btn-secondary",to:"/scola/monitoring/rn"},{default:(0,r.k6)((function(){return[(0,r.eW)("Suivi du dépôt des relevés de notes ")]})),_:1})])])])]),(0,r.Lk)("div",O,[(0,r.Lk)("div",X,[j,(0,r.Lk)("div",I,[(0,r.Lk)("h2",P,[(0,r.bF)(i,{class:"btn btn-secondary",to:"/scola/import/attest"},{default:(0,r.k6)((function(){return[(0,r.eW)("Importer des attestations de réussite ")]})),_:1})]),(0,r.Lk)("h2",B,[(0,r.bF)(i,{class:"btn btn-secondary",to:"/scola/monitoring/attest"},{default:(0,r.k6)((function(){return[(0,r.eW)("Suivi du dépôt des attestations de réussite ")]})),_:1})])])])])])])}]]);var q={class:"container"},$={style:{"--bs-breadcrumb-divider":"'>'"},"aria-label":"breadcrumb"},V={class:"breadcrumb"};n(2892),n(4114);var z=function(e){return(0,r.Qi)("data-v-68fc5170"),e=e(),(0,r.jt)(),e},H={key:0},K={key:1},Y={class:"mb-3"},J={for:"input_rn",class:"form-label"},Z={class:"mb-3"},ee=z((function(){return(0,r.Lk)("label",{for:"input_etu",class:"form-label"},"Fichier ETU",-1)})),te={key:0,class:"mb-3"},ne=z((function(){return(0,r.Lk)("label",{for:"select_sem",class:"form-label"},"Semestre",-1)})),re=[(0,r.Fv)("<option data-v-68fc5170>1</option><option data-v-68fc5170>2</option><option data-v-68fc5170>A</option><option data-v-68fc5170>1p1</option><option data-v-68fc5170>1p2</option><option data-v-68fc5170>1p3</option><option data-v-68fc5170>2p1</option><option data-v-68fc5170>2p2</option><option data-v-68fc5170>2p3</option><option data-v-68fc5170>Ap1</option><option data-v-68fc5170>Ap2</option><option data-v-68fc5170>Ap3</option>",12)],oe={key:1,class:"mb-3"},ae=z((function(){return(0,r.Lk)("label",{for:"select_sess",class:"form-label"},"Session",-1)})),se=[z((function(){return(0,r.Lk)("option",null,"1",-1)})),z((function(){return(0,r.Lk)("option",null,"2",-1)})),z((function(){return(0,r.Lk)("option",null,"U",-1)}))],ie={key:2,class:"mb-3"},le=z((function(){return(0,r.Lk)("label",{for:"txt_lib",class:"form-label"},"Libellé",-1)})),ue={class:"mb-3"},ce=z((function(){return(0,r.Lk)("label",{for:"input_tampon",class:"form-label"},"Tampon",-1)})),de={class:"mb-3"},pe=z((function(){return(0,r.Lk)("label",{for:"txt_tampon",class:"form-label"},"Numéro de page d'exemple pour tampon",-1)})),me=["disabled"],fe=["disabled"],he={key:2,class:"text-center"},ve=[z((function(){return(0,r.Lk)("div",{class:"lds-ripple"},[(0,r.Lk)("div"),(0,r.Lk)("div")],-1)}))];n(8706),n(5700),n(9572),n(2675),n(9463),n(6280),n(4185),n(2259),n(3792),n(7764),n(2953);var be=n(1083);function ge(e){return ge="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ge(e)}function ye(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,ke(r.key),r)}}function ke(e){var t=function(e,t){if("object"!=ge(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=ge(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==ge(t)?t:String(t)}const Le=new(function(){function e(){var t,n,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t=this,r="",(n=ke(n="BASE_URL"))in t?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r}var t,n,r;return t=e,(n=[{key:"getMonitoring",value:function(e){return 0===e?be.A.get(this.BASE_URL+"/api/monitoring/rn"):be.A.get(this.BASE_URL+"/api/monitoring/attest")}},{key:"searchStudent",value:function(e){return be.A.post(this.BASE_URL+"/api/scola/search",e)}},{key:"getStudentDocs",value:function(e){return be.A.get(this.BASE_URL+"/api/etudiant/"+e)}},{key:"importRn",value:function(e,t){var n=new FormData;return n.append("pdf",t.pdf),n.append("etu",t.etu),n.append("sem",t.sem),n.append("sess",t.sess),n.append("lib",t.lib),n.append("tampon",t.tampon),n.append("numTampon",t.numTampon),0===e?be.A.post(this.BASE_URL+"/api/import/rn",n,{headers:{"Content-Type":"multipart/form-data"}}):be.A.post(this.BASE_URL+"/api/import/attests",n,{headers:{"Content-Type":"multipart/form-data"}})}},{key:"truncate",value:function(e,t){return be.A.post(this.BASE_URL+"/api/import/truncate_unit",{page:e,mode:t})}},{key:"getSelection",value:function(e){return 0===e?be.A.get(this.BASE_URL+"/api/selection/rn"):be.A.get(this.BASE_URL+"/api/selection/attest")}},{key:"transfertRn",value:function(e,t){return be.A.post(this.BASE_URL+"/api/transfert/releves",{nums:e,mode:t})}},{key:"fetchMailTemplate",value:function(){return be.A.get(this.BASE_URL+"/api/transfert/mail/template")}},{key:"sendMail",value:function(e,t){return be.A.post(this.BASE_URL+"/api/transfert/mail",{ids:e,mode:t})}},{key:"getTamponExample",value:function(e){return be.A.get(this.BASE_URL+"/api/get_tampon_example/"+e,{responseType:"blob"})}},{key:"applyTampon",value:function(e,t){return be.A.post(this.BASE_URL+"/api/apply_tampon",{dx:e,dy:t})}},{key:"fetchRnFiles",value:function(e){return be.A.get(this.BASE_URL+"/api/import/imported/"+e)}},{key:"removeFiles",value:function(e,t){return be.A.post(this.BASE_URL+"/api/monitoring/delete",{dataId:e,numsEtu:t})}},{key:"sendMails",value:function(e){return be.A.post(this.BASE_URL+"/api/transfert/mail",{numsEtu:e,mode:0})}},{key:"getDownloadURL",value:function(e){return 0===e?this.BASE_URL+"/api/etudiant/download/releve/":this.BASE_URL+"/api/etudiant/download/attest/"}},{key:"getSrcTampon",value:function(){return this.BASE_URL+"/api/get_tampon/"}},{key:"getPreviewTmpRn",value:function(e){return this.BASE_URL+"/preview/tmp/releves/"+e}},{key:"getPreviewTmpAttest",value:function(e){return this.BASE_URL+"/preview/tmp/attests/"+e}},{key:"getPreviewRn",value:function(e,t){return this.BASE_URL+"/preview/releves/".concat(e,"/").concat(t)}},{key:"getPreviewAttest",value:function(e,t){return this.BASE_URL+"/preview/attests/".concat(e,"/").concat(t)}},{key:"rebuild",value:function(e){return be.A.get(this.BASE_URL+"/api/selection/rebuild/".concat(e),{responseType:"blob"})}},{key:"getUsers",value:function(){return be.A.get(this.BASE_URL+"/api/user/")}},{key:"deleteUser",value:function(e){return be.A.delete(this.BASE_URL+"/api/user/"+e)}},{key:"addUser",value:function(e){return be.A.post(this.BASE_URL+"/api/user/",{user:e})}},{key:"getGroups",value:function(){return be.A.get(this.BASE_URL+"/api/user/group/")}},{key:"deleteGroup",value:function(e){return be.A.delete(this.BASE_URL+"/api/user/group/"+e)}},{key:"addGroup",value:function(e){return be.A.post(this.BASE_URL+"/api/user/group",{group:e})}},{key:"findUsers",value:function(e){return be.A.post(this.BASE_URL+"/api/user/search",{user:e})}}])&&ye(t.prototype,n),r&&ye(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}());var we=new(n(8549).zT)({duration:3e3,position:{x:"right",y:"top"},types:[{type:"file_imported",background:"#006d82",icon:!1,position:{x:"right",y:"bottom"},duration:5e3},{type:"short_success",background:"#006d82",icon:!1,position:{x:"right",y:"bottom"},duration:2500},{type:"error",background:"#d60550",icon:!1,position:{x:"right",y:"bottom"},duration:5e3},{type:"short_error",background:"#d60550",icon:!1,position:{x:"right",y:"bottom"},duration:2500}]});function Ce(e,t){we.open({type:t,message:e})}const Se={name:"Import",emits:["imported"],props:{mode:Number},data:function(){return{rn:{pdf:"",etu:"",sem:0===this.mode?"1":"",sess:0===this.mode?"1":"",lib:"",tampon:"",numTampon:1},canSubmit:!0}},methods:{importRn:function(e){var t=this;this.canSubmit=!1,Le.importRn(this.mode,this.rn).then((function(e){t.$emit("imported",e.data)})).catch((function(e){void 0!==e.response.data.error?Ce(e.response.data.error,"error"):Ce("Une erreur est survenue lors de l'importation du relevé de notes","error"),console.log(e),t.canSubmit=!0}))},onPdfFileChange:function(e){this.rn.pdf=e.target.files[0]},onEtuFileChange:function(e){this.rn.etu=e.target.files[0]},onTamponFileChange:function(e){this.rn.tampon=e.target.files[0]}},mounted:function(){},watch:{mode:function(){this.rn.sem=0===this.mode?"1":"",this.rn.sess=0===this.mode?"1":"",this.rn.pdf="",document.getElementById("input_rn").value="",this.rn.etu="",document.getElementById("input_etu").value="",this.rn.tampon="",document.getElementById("input_tampon").value="",this.rn.numTampon=1}}},xe=(0,S.A)(Se,[["render",function(e,t,n,o,a,s){var i=this;return(0,r.uX)(),(0,r.CE)(r.FK,null,[0===n.mode?((0,r.uX)(),(0,r.CE)("h3",H,"Extraction des relevés de notes")):(0,r.Q3)("v-if",!0),1===n.mode?((0,r.uX)(),(0,r.CE)("h3",K,"Extraction des attestations de réussite")):(0,r.Q3)("v-if",!0),(0,r.Lk)("form",{class:"mt-3",onSubmit:t[7]||(t[7]=(0,r.D$)((function(e){return i.importRn()}),["prevent"]))},[(0,r.Lk)("div",Y,[(0,r.Lk)("label",J,(0,r.v_)(0===this.mode?"Relevé de notes":"Attestation"),1),(0,r.Lk)("input",{type:"file",accept:"application/pdf",required:"",onChange:t[0]||(t[0]=function(e){return s.onPdfFileChange(e)}),class:"form-control",id:"input_rn"},null,32)]),(0,r.Lk)("div",Z,[ee,(0,r.Lk)("input",{type:"file",accept:".etu",required:"",onChange:t[1]||(t[1]=function(e){return s.onEtuFileChange(e)}),class:"form-control",id:"input_etu"},null,32)]),0===n.mode?((0,r.uX)(),(0,r.CE)("div",te,[ne,(0,r.bo)((0,r.Lk)("select",{id:"select_sem",required:"",class:"form-select","onUpdate:modelValue":t[2]||(t[2]=function(e){return i.rn.sem=e})},re,512),[[r.u1,this.rn.sem]])])):(0,r.Q3)("v-if",!0),0===n.mode?((0,r.uX)(),(0,r.CE)("div",oe,[ae,(0,r.bo)((0,r.Lk)("select",{id:"select_sess",required:"",class:"form-select","onUpdate:modelValue":t[3]||(t[3]=function(e){return i.rn.sess=e})},se,512),[[r.u1,this.rn.sess]])])):(0,r.Q3)("v-if",!0),0===n.mode?((0,r.uX)(),(0,r.CE)("div",ie,[le,(0,r.bo)((0,r.Lk)("input",{type:"text",required:"","onUpdate:modelValue":t[4]||(t[4]=function(e){return i.rn.lib=e}),class:"form-control",id:"txt_lib"},null,512),[[r.Jo,this.rn.lib]])])):(0,r.Q3)("v-if",!0),(0,r.Lk)("div",ue,[ce,(0,r.Lk)("input",{type:"file",accept:".png",onChange:t[5]||(t[5]=function(e){return s.onTamponFileChange(e)}),class:"form-control",id:"input_tampon"},null,32)]),(0,r.Lk)("div",de,[pe,(0,r.bo)((0,r.Lk)("input",{type:"number",min:"1",required:"","onUpdate:modelValue":t[6]||(t[6]=function(e){return i.rn.numTampon=e}),disabled:""===this.rn.tampon,class:"form-control",id:"txt_tampon"},null,8,me),[[r.Jo,this.rn.numTampon]])]),(0,r.Lk)("button",{type:"submit",class:"btn btn-primary",disabled:!a.canSubmit},"Charger",8,fe)],32),a.canSubmit?(0,r.Q3)("v-if",!0):((0,r.uX)(),(0,r.CE)("div",he,ve))],64)}],["__scopeId","data-v-68fc5170"]]);var De=(0,r.Lk)("div",{style:{"text-align":"center"}},[(0,r.Lk)("h2",{style:{display:"inline-block",margin:"0 auto"}},"Découpage du document PDF")],-1),Ee={class:"row justify-content-md-center",id:"pg_container",style:{"margin-top":"17px","margin-bottom":"17px",width:"100%"}},Re={class:"progress",style:{width:"75%",height:"35px"}},_e=["aria-valuenow"];n(761);const Ae={name:"Truncate",emits:["truncated"],props:{pageCount:0,pageIndex:0,mode:Number},data:function(){return{percent:0}},methods:{callTruncate:function(e){var t=this;Le.truncate(e,this.mode).then((function(e){var n=e.data;n>0?(t.percent=Math.trunc((n-1)/t.pageCount*100),t.callTruncate(n)):t.$emit("truncated")})).catch((function(e){console.log("fail")}))}},mounted:function(){this.callTruncate(this.pageIndex)}},Ue=(0,S.A)(Ae,[["render",function(e,t,n,o,a,s){return(0,r.uX)(),(0,r.CE)(r.FK,null,[De,(0,r.Lk)("div",Ee,[(0,r.Lk)("div",Re,[(0,r.Lk)("div",{class:"progress-bar progress-bar-striped progress-bar-animated",id:"truncate_pg",role:"progressbar","aria-valuenow":a.percent,"aria-valuemin":"0","aria-valuemax":"100",style:(0,r.Tr)({width:a.percent+"%",visibility:"visible",height:"35px"})},(0,r.v_)(a.percent)+"% ",13,_e)])])],64)}]]);var Ge={key:0,class:"mt-2 row justify-content-md-center"},Te={key:0,class:"form-group col-sm-2"},Ne=(0,r.Lk)("label",{class:"control-label"},"Semestre",-1),Fe={key:1,class:"form-group col-sm-2"},Me=(0,r.Lk)("label",{class:"control-label"},"Session",-1),Oe={class:"form-group col-sm-2"},Xe=(0,r.Lk)("label",{class:"control-label"},"Libellé",-1),je=["value"],Ie={class:"form-group col-sm-2"},Pe=(0,r.Lk)("label",{class:"control-label"},"Code",-1),Be=["value"],We={class:"form-group col-sm-2"},Qe=(0,r.Lk)("label",{class:"control-label"},"Année",-1),qe={id:"transfert_div",class:"row justify-content-md-center mt-2"},$e=["disabled"],Ve={key:0},ze={key:1};n(2062),n(3288),n(4346),n(4782),n(8781),n(3418),n(7495),n(906);var He=n(2047);function Ke(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a,s,i=[],l=!0,u=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=a.call(n)).done)&&(i.push(r.value),i.length!==t);l=!0);}catch(e){u=!0,o=e}finally{try{if(!l&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(u)throw o}}return i}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Ye(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ye(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ye(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}const Je={name:"Selection",props:{mode:Number},components:{AgGridVue:He.b},emits:["selected"],data:function(){var e=this;return{data:null,students:null,selectedRows:[],defaultColDef:{sortable:!0,filter:!0,resizable:!0,minWidth:100,editable:!1,flex:1},columnDefs:[{field:"numero",headerName:"Numero",headerCheckboxSelection:!0,checkboxSelection:!0,headerCheckboxSelectionFilteredOnly:!0,showDisabledCheckboxes:!0},{field:"name",headerName:"Nom"},{field:"surname",headerName:"Prenom"},{field:"birthday",headerName:"Date de naissance",comparator:this.dateComparator},{field:"mail",headerName:"Mail"},{headerName:"Relevé",flex:2,cellRenderer:function(t){return 0===e.mode?'<a target="_blank" href="'.concat(Le.getPreviewTmpRn(t.data.numero),'">').concat(t.data.file,"</a>"):'<a target="_blank" href="'.concat(Le.getPreviewTmpAttest(t.data.numero),'">').concat(t.data.file,"</a>")}},{headerName:"Relevé déjà existant",cellStyle:{textAlign:"center"},cellRenderer:function(t){if(-1!==t.data.index)return 0===e.mode?'<a target="_blank" href="'.concat(Le.getPreviewRn(t.data.numero,t.data.index),'">Voir</a>'):'<a target="_blank" href="'.concat(Le.getPreviewAttest(t.data.numero,t.data.index),'">Voir</a>')}}]}},methods:{dateComparator:function(e,t){var n=Ke(e.split("/").map(Number),3),r=n[0],o=n[1],a=n[2],s=Ke(t.split("/").map(Number),3),i=s[0],l=s[1],u=s[2];return new Date(a,o-1,r)-new Date(u,l-1,i)},fetchSelection:function(){var e=this;Le.getSelection(this.mode).then((function(t){e.data=t.data.data,e.students=t.data.students})).catch((function(e){console.log("fail")}))},onSelectionChanged:function(e){this.selectedRows=e.api.getSelectedRows()},OnGO:function(){confirm("En continuant, les documents sélectionnés seront transférés.")&&this.$emit("selected",this.selectedRows.map((function(e){return e.numero})),this.students,this.data)}},mounted:function(){this.fetchSelection()}},Ze=(0,S.A)(Je,[["render",function(e,t,n,o,a,s){var i=this,l=(0,r.g2)("ag-grid-vue");return(0,r.uX)(),(0,r.CE)(r.FK,null,[(0,r.Q3)("  HEADER INFO"),null!==this.data?((0,r.uX)(),(0,r.CE)("div",Ge,[0===this.mode?((0,r.uX)(),(0,r.CE)("div",Te,[Ne,(0,r.bo)((0,r.Lk)("input",{"onUpdate:modelValue":t[0]||(t[0]=function(e){return i.data.semestre=e}),class:"form-control",style:{"text-align":"center"},name:"session",type:"text",disabled:""},null,512),[[r.Jo,this.data.semestre]])])):(0,r.Q3)("v-if",!0),0===this.mode?((0,r.uX)(),(0,r.CE)("div",Fe,[Me,(0,r.bo)((0,r.Lk)("input",{"onUpdate:modelValue":t[1]||(t[1]=function(e){return i.data.session=e}),class:"form-control",style:{"text-align":"center"},type:"text",disabled:""},null,512),[[r.Jo,this.data.session]])])):(0,r.Q3)("v-if",!0),(0,r.Lk)("div",Oe,[Xe,(0,r.Lk)("input",{class:"form-control",style:{"text-align":"center"},type:"text",disabled:"",value:""===a.data.libelle?a.data.libelle_form:a.data.libelle},null,8,je)]),(0,r.Lk)("div",Ie,[Pe,(0,r.Lk)("input",{class:"form-control",style:{"text-align":"center"},type:"text",disabled:"",value:""===a.data.code?a.data.code_obj:a.data.code},null,8,Be)]),(0,r.Lk)("div",We,[Qe,(0,r.bo)((0,r.Lk)("input",{"onUpdate:modelValue":t[2]||(t[2]=function(e){return i.data.year=e}),class:"form-control",style:{"text-align":"center"},type:"text",disabled:""},null,512),[[r.Jo,this.data.year]])])])):(0,r.Q3)("v-if",!0),(0,r.Q3)("  BUTTONS"),(0,r.Lk)("div",qe,[(0,r.Lk)("button",{type:"button",class:"btn btn-primary",id:"btn_go",disabled:0===a.selectedRows.length,onClick:t[3]||(t[3]=function(){return s.OnGO&&s.OnGO.apply(s,arguments)})},[0===a.selectedRows.length?((0,r.uX)(),(0,r.CE)("span",Ve,"Continuer")):((0,r.uX)(),(0,r.CE)("span",ze,"Continuer ("+(0,r.v_)(this.selectedRows.length)+" / "+(0,r.v_)(this.students.length)+")",1))],8,$e)]),(0,r.Q3)("  TABLEAU"),(0,r.bF)(l,{class:"ag-theme-alpine",style:{height:"75vh"},columnDefs:a.columnDefs,rowData:this.students,defaultColDef:a.defaultColDef,pagination:"true",suppressRowClickSelection:"true",rowSelection:"multiple",animateRows:"true",ensureDomOrder:!0,onSelectionChanged:s.onSelectionChanged,enableCellTextSelection:!0},null,8,["columnDefs","rowData","defaultColDef","onSelectionChanged"])],64)}]]);var et={style:{"text-align":"center"}},tt={style:{display:"inline-block",margin:"0 auto"}},nt={key:0,class:"row justify-content-md-center",style:{"margin-top":"17px","margin-bottom":"17px",width:"100%"}},rt={class:"progress",style:{width:"75%",height:"35px"}},ot=["aria-valuenow"],at={key:1,class:"container",style:{width:"100%"}},st={style:{"border-style":"outset",padding:"5px"}},it=(0,r.Fv)('<div class="row"><div class="col-2"><p>Expéditeur : </p></div><div class="col-6"><a href="mailto: noreply@uca.fr">noreply@uca.fr</a></div></div><div class="row"><div class="col-2"><p>Sujet : </p></div><div class="col-6"><p>Dépôt de document Université Clermont Auvergne</p></div></div>',2),lt={class:"row"},ut=(0,r.Lk)("div",{class:"col-2"},[(0,r.Lk)("p",null,"Contenu : ")],-1),ct=["innerHTML"],dt={style:{"text-align":"center"},class:"mt-2 mb-2"},pt=(0,r.Lk)("h5",null,[(0,r.Lk)("strong",null,"Voulez-vous envoyer un mail de notification aux étudiants concernés ?")],-1),mt={class:"row justify-content-md-center"},ft={class:"col-auto"},ht={class:"col-auto"};const vt={name:"Transfert",emits:["finished"],props:{students:null,selectedRows:null,mode:Number},data:function(){return{index:0,percent:0,tranfert_done:!1,templateMail:null,nbDocToTransfert:0,numsToTransfert:null}},methods:{fetchMailTemplate:function(){var e=this;Le.fetchMailTemplate().then((function(t){e.templateMail=t.data})).catch((function(e){console.log("fail")}))},transfert:function(){var e=this;Le.transfertRn(this.numsToTransfert,this.mode).then((function(t){e.numsToTransfert=t.data,e.index=e.nbDocToTransfert-e.numsToTransfert.length,e.percent=Math.floor(e.index/e.nbDocToTransfert*100),e.numsToTransfert.length>0?e.transfert():(e.tranfert_done=!0,e.fetchMailTemplate())})).catch((function(e){alert("Une erreur est survenue lors du transfert des documents. Merci de réessayer plus tard.")}))},sendMails:function(e){var t=this;e?Le.sendMails(this.selectedRows).then((function(e){alert("Les mails ont été envoyés"),t.$emit("finished")})).catch((function(e){console.log("fail")})):this.$emit("finished")}},mounted:function(){this.nbDocToTransfert=this.selectedRows.length,this.numsToTransfert=this.selectedRows,this.transfert()}},bt=(0,S.A)(vt,[["render",function(e,t,n,o,a,s){return(0,r.uX)(),(0,r.CE)(r.FK,null,[(0,r.Lk)("div",et,[(0,r.Lk)("h3",tt,"Transfert de "+(0,r.v_)(this.nbDocToTransfert)+" / "+(0,r.v_)(this.students.length)+" documents",1)]),a.tranfert_done?(0,r.Q3)("v-if",!0):((0,r.uX)(),(0,r.CE)("div",nt,[(0,r.Lk)("div",rt,[(0,r.Lk)("div",{class:(0,r.C4)({"progress-bar":!0,"progress-bar-striped":!0,"progress-bar-animated":!a.tranfert_done}),role:"progressbar","aria-valuenow":a.percent,"aria-valuemin":"0","aria-valuemax":"100",style:(0,r.Tr)({width:a.percent+"%",visibility:"visible",height:"35px"})},(0,r.v_)(a.percent)+"% ",15,ot)])])),null!==a.templateMail?((0,r.uX)(),(0,r.CE)("div",at,[(0,r.Lk)("div",st,[it,(0,r.Lk)("div",lt,[ut,(0,r.Lk)("div",{class:"col-6",innerHTML:a.templateMail},null,8,ct)])]),(0,r.Lk)("div",dt,[pt,(0,r.Lk)("div",mt,[(0,r.Lk)("div",ft,[(0,r.Lk)("button",{class:"btn btn-primary",onClick:t[0]||(t[0]=function(e){return s.sendMails(!0)}),type:"button"},"Oui ")]),(0,r.Lk)("div",ht,[(0,r.Lk)("button",{onClick:t[1]||(t[1]=function(e){return s.sendMails(!1)}),class:"btn btn-secondary",type:"button"},"Non ")])])])])):(0,r.Q3)("v-if",!0)],64)}]]);var gt=["src"],yt=["data"],kt=[(0,r.Lk)("p",null,"Unable to display PDF file.",-1)];n(3296),n(8408);const Lt={name:"Tampon",props:{mode:Number},emits:["tamponned"],data:function(){return{tamponExample:null,dragging:!1,lastX:0,lastY:0}},methods:{WebService:function(){return Le},fetchTampon:function(){var e=this;Le.getTamponExample(this.mode).then((function(t){e.tamponExample=URL.createObjectURL(t.data)})).catch((function(e){console.log(e.response.data.error)}))},onMouseMove:function(e){if(this.dragging){var t=e.clientX-this.lastX,n=e.clientY-this.lastY,r=document.getElementById("draggable");r.style.left=r.offsetLeft+t+"px",r.style.top=r.offsetTop+n+"px",this.lastX=e.clientX,this.lastY=e.clientY}else e.preventDefault()},preventDrag:function(e){e.preventDefault()},onMouseUp:function(e){this.dragging=!1},onMouseDown:function(e){this.dragging=!0,this.lastX=e.clientX,this.lastY=e.clientY},allowDrop:function(e){e.preventDefault()},applyTampon:function(){var e=this,t=document.getElementById("pdf").getBoundingClientRect().width-48,n=document.getElementById("pdf").getBoundingClientRect().height-5-54,r=document.getElementById("pdf").getBoundingClientRect(),o=document.getElementById("draggable").getBoundingClientRect(),a=210*(o.x-r.x-24)/t,s=297*(o.y-r.y-5)/n;Le.applyTampon(a,s).then((function(t){e.$emit("tamponned")})).catch((function(e){console.log(e.response.data.error)}))}},mounted:function(){this.fetchTampon(),window.addEventListener("mousemove",this.onMouseMove),window.addEventListener("mouseup",this.onMouseUp)},beforeUnmount:function(){window.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("mouseup",this.onMouseUp)}},wt={name:"ImportDoc",components:{Tampon:(0,S.A)(Lt,[["render",function(e,t,n,o,a,s){return(0,r.uX)(),(0,r.CE)(r.FK,null,[(0,r.Lk)("img",{alt:"tampon",style:{"z-index":"1",position:"absolute"},id:"draggable",draggable:"true",onMousedown:t[0]||(t[0]=function(){return s.onMouseDown&&s.onMouseDown.apply(s,arguments)}),onDragstart:t[1]||(t[1]=function(){return s.preventDrag&&s.preventDrag.apply(s,arguments)}),src:s.WebService().getSrcTampon()+this.mode},null,40,gt),(0,r.Lk)("button",{class:"btn btn-primary mb-2",type:"button",onClick:t[2]||(t[2]=function(){return s.applyTampon&&s.applyTampon.apply(s,arguments)})},"Appliquer le tampon"),(0,r.Lk)("object",{onDragover:t[3]||(t[3]=function(){return s.allowDrop&&s.allowDrop.apply(s,arguments)}),id:"pdf",data:a.tamponExample+"#zoom=100&pagemode=none&scrollbar=0&toolbar=0&statusbar=1&messages=0&navpanes=0",type:"application/pdf",width:"840px",height:"1180px"},kt,40,yt)],64)}]]),Transfert:bt,Selection:Ze,Truncate:Ue,Import:xe},props:{mode:Number},data:function(){return{step:0,importData:null,students:null,selectedRows:null}},methods:{onDataImported:function(e){this.importData=e,this.importData.sameParams&&alert("Les paramètres correspondent à un dépôt existant"),"tampon"===this.importData.step?this.step=1:this.step=2},onDataTruncated:function(){this.step=3},onSelected:function(e,t,n){this.step=4,this.students=t,this.selectedRows=e},onTamponned:function(){this.step=2},onTransfertFinished:function(){this.step=5,0===this.mode?this.$router.push({path:"/scola/monitoring/rn"}):1===this.mode&&this.$router.push({path:"/scola/monitoring/attest"})}},beforeRouteLeave:function(e,t,n){this.step>0&&5!==this.step?confirm("Voulez-vous vraiment quitter cette page ?")?n():n(!1):n()},mounted:function(){},watch:{mode:function(){this.step=0}}},Ct=(0,S.A)(wt,[["render",function(e,t,n,o,a,s){var i=(0,r.g2)("Import"),l=(0,r.g2)("Tampon"),u=(0,r.g2)("Truncate"),c=(0,r.g2)("Selection"),d=(0,r.g2)("Transfert");return(0,r.uX)(),(0,r.CE)(r.FK,null,[(0,r.Lk)("div",q,[(0,r.Lk)("nav",$,[(0,r.Lk)("ol",V,[(0,r.Lk)("li",{class:(0,r.C4)(["breadcrumb-item active",{"text-primary":0===a.step,"fw-bold":0===a.step}]),"aria-current":"page"},"Import ",2),(0,r.Lk)("li",{class:(0,r.C4)(["breadcrumb-item active",{"text-primary":1===a.step,"fw-bold":1===a.step}]),"aria-current":"page"},"Tamponnage ",2),(0,r.Lk)("li",{class:(0,r.C4)(["breadcrumb-item active",{"text-primary":2===a.step,"fw-bold":2===a.step}]),"aria-current":"page"},"Découpage ",2),(0,r.Lk)("li",{class:(0,r.C4)(["breadcrumb-item active",{"text-primary":3===a.step,"fw-bold":3===a.step}]),"aria-current":"page"},"Sélection ",2),(0,r.Lk)("li",{class:(0,r.C4)(["breadcrumb-item active",{"text-primary":4===a.step,"fw-bold":4===a.step}]),"aria-current":"page"},"Transfert ",2)])])]),(0,r.Lk)("div",{class:(0,r.C4)({container:2!==a.step,"container-fluid":2===a.step})},[0===a.step?((0,r.uX)(),(0,r.Wv)(i,{key:0,mode:n.mode,onImported:s.onDataImported},null,8,["mode","onImported"])):(0,r.Q3)("v-if",!0),1===a.step?((0,r.uX)(),(0,r.Wv)(l,{key:1,mode:n.mode,onTamponned:s.onTamponned},null,8,["mode","onTamponned"])):(0,r.Q3)("v-if",!0),2===a.step?((0,r.uX)(),(0,r.Wv)(u,{key:2,mode:n.mode,"page-count":this.importData.pageCount,"page-index":this.importData.pageFirst,onTruncated:s.onDataTruncated},null,8,["mode","page-count","page-index","onTruncated"])):(0,r.Q3)("v-if",!0),3===a.step?((0,r.uX)(),(0,r.Wv)(c,{key:3,mode:n.mode,onSelected:s.onSelected},null,8,["mode","onSelected"])):(0,r.Q3)("v-if",!0),4===a.step?((0,r.uX)(),(0,r.Wv)(d,{key:4,mode:n.mode,students:this.students,selectedRows:this.selectedRows,onFinished:s.onTransfertFinished},null,8,["mode","students","selectedRows","onFinished"])):(0,r.Q3)("v-if",!0)],2)],64)}]]);var St={class:"container-fluid"},xt={class:"modal fade",id:"historiqueModal",tabindex:"-1","aria-labelledby":"historiqueModalLabel","aria-hidden":"true"},Dt={class:"modal-dialog modal-xl"},Et={class:"modal-content"},Rt=(0,r.Lk)("div",{class:"modal-header"},[(0,r.Lk)("h1",{class:"modal-title fs-5",id:"historiqueModalLabel"},"Historique"),(0,r.Lk)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),_t={class:"modal-body"},At=(0,r.Lk)("div",{class:"modal-footer"},[(0,r.Lk)("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Fermer")],-1),Ut={class:"modal fade",id:"suppressionModal",tabindex:"-1","aria-labelledby":"suppressionModalLabel","aria-hidden":"true"},Gt={class:"modal-dialog modal-xl"},Tt={class:"modal-content"},Nt=(0,r.Lk)("div",{class:"modal-header"},[(0,r.Lk)("h1",{class:"modal-title fs-5",id:"suppressionModalLabel"},"Suppression de documents"),(0,r.Lk)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Ft={class:"modal-body"},Mt=(0,r.Lk)("div",{class:"alert alert-warning"},"La suppression est définitive, les étudiants n'auront plus accès aux documents ",-1),Ot={class:"modal-footer"},Xt=(0,r.Lk)("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Fermer",-1),jt=["disabled"],It={key:0,class:"text-center"},Pt={key:1,class:"text-center"};n(5440),n(2762),n(8980);function Bt(e){return function(e){if(Array.isArray(e))return Wt(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return Wt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Wt(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Wt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Qt={template:'<button data-bs-toggle="modal" :data-bs-target="this.params.modal" data-bs-backdrop="true" class="btn btn-outline-secondary mt-1"\n                style="height: 30px;width: 15px" v-on:click="this.params.onClicked(this.params.data)">\n                    <span :class="this.params.txt"></span>\n             </button>'},qt={template:'<button style="height: 30px;width: 15px" class="btn btn-outline-secondary mt-1" v-on:click="this.params.onClicked(this.params.data)">\n                 <span :class="this.params.txt"></span>\n            </button>'};const $t={name:"MonitoringDoc",props:{mode:Number},components:{AgGridVue:He.b},data:function(){return{selected:null,selectedDeleteRows:null,files:null,monitoring:null,defaultColDef:{floatingFilter:!0,sortable:!0,filter:!0,resizable:!0,minWidth:100,editable:!1,flex:1},autoSizeStrategy:{type:"fitCellContents",skipHeader:!1},columnDefs:this.getColDefs(),columnHistorique:[{field:"formattedDate",headerName:"Date"},{headerName:"Nombre de fichiers",valueGetter:function(e){return e.data.nb_files>0?"+"+e.data.nb_files:e.data.nb_files}},{headerName:"Action",editable:!1,valueGetter:function(e){return 1===e.data.state?"Dépot initial":2===e.data.state?"Dépot supplémentaire":3===e.data.state?"Suppression":"Erreur"}}],columnEdit:[{headerName:"Fichier",field:"file",headerCheckboxSelection:!0,checkboxSelection:!0,headerCheckboxSelectionFilteredOnly:!0,showDisabledCheckboxes:!0},{field:"codeEtu",headerName:"Numéro étudiant"},{field:"nom",headerName:"Nom"},{field:"prenom",headerName:"Prénom"}]}},methods:{onCellFocused:function(e){6===e.column.getColId()&&(e.api.deselectAll(),e.api.clearFocusCell())},getColDefs:function(){var e=this;return[{field:"username",headerName:"Utilisateur",hide:!w.isAdmin()},{headerName:"Date de traitement",valueGetter:function(e){return e.data.history.slice(-1)[0].formattedDate}},{headerName:0===this.mode?"Année universitaire / Session / Semestre":"Année universitaire",valueGetter:function(t){return 0===e.mode?t.data.year+" / "+t.data.session+" / "+t.data.semestre:t.data.year}},{headerName:"Code",valueGetter:function(e){return e.data.type+" / "+e.data.code_obj+" / "+e.data.code}},{headerName:"Libellé",valueGetter:function(t){return 0===e.mode?t.data.libelle_form+" / "+t.data.libelle:t.data.libelle_obj+" / "+t.data.libelle}},{headerName:"Nombre de transferts",cellClass:"text-center",valueGetter:function(e){return e.data.nb_students}},{headerName:"Historique",floatingFilter:!1,cellRenderer:Qt,cellClassRules:{"non-selectable":!0},cellRendererParams:{onClicked:function(t){return e.selected=t},txt:"mdi mdi-history mdi-24px",modal:"#historiqueModal"}},{headerName:"Fichiers",floatingFilter:!1,cellRenderer:Qt,cellRendererParams:{onClicked:function(t){e.selected=t,e.files=[],e.fetchFiles(t.id)},txt:"mdi mdi-file-remove mdi-24px",modal:"#suppressionModal"}},{headerName:"Reconstruction",floatingFilter:!1,cellRenderer:qt,cellRendererParams:{onClicked:function(t){return e.rebuildDoc(t)},txt:"mdi mdi-file-multiple mdi-24px"}}]},rebuildDoc:function(e){Ce("Reconstruction en cours...","short_success"),Le.rebuild(e.id).then((function(e){Ce("Reconstruction finie","short_success");var t=e.headers["content-disposition"].split(";")[1].split("=")[1].trim().replace(/"/g,""),n=URL.createObjectURL(e.data),r=document.createElement("a");r.href=n,r.download=t,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(n)})).catch((function(e){Ce("Reconstruction fail","short_error")}))},fetchRnMonitoring:function(){var e=this;Le.getMonitoring(this.mode).then((function(t){e.monitoring=t.data})).catch((function(e){console.log(e),Ce("Erreur lors de la récupération des données","short_error")}))},fetchFiles:function(e){var t=this;Le.fetchRnFiles(e).then((function(e){t.files=e.data})).catch((function(e){console.log(e),alert("Erreur lors de la récupération des données")}))},removeFiles:function(){var e=this;if(null!==this.selectedDeleteRows&&0!==this.selectedDeleteRows.length&&confirm("Voulez-vous vraiment supprimer "+this.selectedDeleteRows.length+" document(s) ?")){var t=this.selectedDeleteRows.map((function(e){return e.codeEtu}));Le.removeFiles(this.selected.id,t).then((function(n){var r=document.querySelector("#suppressionModal");bootstrap.Modal.getOrCreateInstance(r).hide();var o=e.monitoring.findIndex((function(e){return e.id===n.data.id}));-1!==o&&(e.monitoring=[].concat(Bt(e.monitoring.slice(0,o)),[n.data],Bt(e.monitoring.slice(o+1)))),Ce(t.length+" fichier(s) supprimé(s)","short_success")})).catch((function(e){console.log(e)}))}},onSelectionDeleteChanged:function(e){this.selectedDeleteRows=e.api.getSelectedRows()}},beforeMount:function(){this.fetchRnMonitoring()},mounted:function(){},beforeRouteLeave:function(e,t,n){var r=document.querySelector("#suppressionModal");bootstrap.Modal.getOrCreateInstance(r).hide();var o=document.querySelector("#historiqueModal");bootstrap.Modal.getOrCreateInstance(o).hide(),n()},watch:{mode:function(){this.columnDefs=this.getColDefs(),this.monitoring=[],this.fetchRnMonitoring()}}},Vt=(0,S.A)($t,[["render",function(e,t,n,o,a,s){var i=(0,r.g2)("ag-grid-vue");return(0,r.uX)(),(0,r.CE)("div",St,[(0,r.Q3)(" Historique Modal "),(0,r.Lk)("div",xt,[(0,r.Lk)("div",Dt,[(0,r.Lk)("div",Et,[Rt,(0,r.Lk)("div",_t,[null!==this.selected?((0,r.uX)(),(0,r.Wv)(i,{key:0,class:"ag-theme-alpine",style:{height:"40vh"},columnDefs:a.columnHistorique,rowData:this.selected.history,defaultColDef:a.defaultColDef,pagination:"true",animateRows:"true",ensureDomOrder:!0,enableCellTextSelection:!0},null,8,["columnDefs","rowData","defaultColDef"])):(0,r.Q3)("v-if",!0)]),At])])]),(0,r.Q3)(" Suppression Modal "),(0,r.Lk)("div",Ut,[(0,r.Lk)("div",Gt,[(0,r.Lk)("div",Tt,[Nt,(0,r.Lk)("div",Ft,[Mt,null!==this.selected?((0,r.uX)(),(0,r.Wv)(i,{key:0,class:"ag-theme-alpine",style:{height:"60vh"},columnDefs:a.columnEdit,rowData:this.files,defaultColDef:a.defaultColDef,onSelectionChanged:s.onSelectionDeleteChanged,rowSelection:"multiple",pagination:"true",animateRows:"true",ensureDomOrder:!0,enableCellTextSelection:!0},null,8,["columnDefs","rowData","defaultColDef","onSelectionChanged"])):(0,r.Q3)("v-if",!0)]),(0,r.Lk)("div",Ot,[Xt,(0,r.Lk)("button",{type:"button",class:"btn btn-primary",onClick:t[0]||(t[0]=function(){return s.removeFiles&&s.removeFiles.apply(s,arguments)}),disabled:null===this.selectedDeleteRows||0===this.selectedDeleteRows.length},"Supprimer les documents ",8,jt)])])])]),0===this.mode?((0,r.uX)(),(0,r.CE)("h3",It,"Suivi des Relevés de notes")):(0,r.Q3)("v-if",!0),1===this.mode?((0,r.uX)(),(0,r.CE)("h3",Pt,"Suivi des Attestations de réussite")):(0,r.Q3)("v-if",!0),(0,r.bF)(i,{class:"ag-theme-alpine",style:{height:"85vh"},columnDefs:a.columnDefs,rowData:a.monitoring,defaultColDef:a.defaultColDef,pagination:"true",animateRows:"true",ensureDomOrder:!0,onCellFocused:s.onCellFocused,localeText:{noRowsToShow:"Aucune donnée à afficher"},enableCellTextSelection:!0},null,8,["columnDefs","rowData","defaultColDef","onCellFocused"])])}]]);var zt={class:"container"},Ht=(0,r.Lk)("div",{class:"row justify-content-md-center"},[(0,r.Lk)("h3",null,"Rechercher les documents d'un étudiant")],-1),Kt={class:"mt-3"},Yt={class:"mb-3"},Jt=(0,r.Lk)("label",{for:"searchFieldInput",class:"form-label"},"Nom ou code étudiant",-1),Zt={class:"mb-3"},en=["disabled"],tn={class:"ag-theme-alpine"};const nn={name:"agNavLink",data:function(){return{toPath:"/",toName:""}},mounted:function(){this.toPath="/student/".concat(this.params.data.CLFDcodeEtu),this.toName=this.params.data.CLFDcodeEtu}},rn=(0,S.A)(nn,[["render",function(e,t,n,o,a,s){var i=(0,r.g2)("router-link");return(0,r.uX)(),(0,r.Wv)(i,{to:a.toPath},{default:(0,r.k6)((function(){return[(0,r.eW)((0,r.v_)(a.toName),1)]})),_:1},8,["to"])}]]),on={name:"SearchStudent",components:{AgGridVue:He.b},data:function(){return{searchField:"",students:null,defaultColDef:{floatingFilter:!0,sortable:!0,filter:!0,resizable:!0,minWidth:100,editable:!1,flex:1},columnDefs:[{field:"CLFDcodeEtu",headerName:"Numéro",cellRenderer:rn},{field:"sn",headerName:"Nom"},{field:"givenName",headerName:"Prénom"},{field:"supannEntiteAffectationPrincipale",headerName:"Composante"},{field:"nb_docs",headerName:"Nombre de documents"}]}},methods:{searchStudent:function(){var e=this;Le.searchStudent(this.searchField).then((function(t){e.students=t.data})).catch((function(e){console.log(e)}))}}},an=(0,S.A)(on,[["render",function(e,t,n,o,a,s){var i=(0,r.g2)("ag-grid-vue");return(0,r.uX)(),(0,r.CE)("div",zt,[Ht,(0,r.Lk)("div",Kt,[(0,r.Lk)("div",Yt,[Jt,(0,r.bo)((0,r.Lk)("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=function(e){return a.searchField=e}),onKeyup:t[1]||(t[1]=(0,r.jR)((function(){return s.searchStudent&&s.searchStudent.apply(s,arguments)}),["enter"])),class:"form-control",id:"searchFieldInput",placeholder:"Dupont | 2320215210"},null,544),[[r.Jo,a.searchField]])]),(0,r.Lk)("div",Zt,[(0,r.Lk)("button",{class:"btn btn-primary",type:"button",onClick:t[2]||(t[2]=function(){return s.searchStudent&&s.searchStudent.apply(s,arguments)}),disabled:""===a.searchField},"Rechercher ",8,en)])]),(0,r.Lk)("div",tn,[null!==a.students?((0,r.uX)(),(0,r.Wv)(i,{key:0,class:"ag-theme-alpine",style:{height:"60vh"},columnDefs:a.columnDefs,rowData:a.students,defaultColDef:a.defaultColDef,pagination:"true",animateRows:"true",ensureDomOrder:!0,enableCellTextSelection:!0},null,8,["columnDefs","rowData","defaultColDef"])):(0,r.Q3)("v-if",!0)])])}]]);n(4490);var sn={key:0,class:"container-lg"},ln={class:"mt-2 mb-2 row"},un=(0,r.Lk)("h4",null,"Documents de scolarité",-1),cn={class:"accordion",id:"accordionPanelsStayOpenExample"},dn={class:"accordion-item mt-2"},pn=["id"],mn=["data-bs-target","aria-expanded","aria-controls"],fn=["id","aria-labelledby"],hn={class:"accordion-body"},vn={class:"row"},bn=(0,r.Lk)("h6",null,[(0,r.Lk)("strong",null,"Relevés de notes")],-1),gn=["href"],yn=(0,r.Lk)("h6",null,[(0,r.Lk)("strong",null,"Attestations de réussite")],-1),kn=["href"],Ln={key:1,class:"container"},wn={class:"mt-2 mb-2 row"},Cn=(0,r.Lk)("h4",null,"Documents de scolarité",-1),Sn={key:0},xn=(0,r.Lk)("div",{class:"alert alert-warning m-5 text-center"},"Aucun document vous concernant n'a été déposé par votre service scolarité",-1);const Dn={name:"StudentView",data:function(){return{docs:null,num:0}},methods:{WebService:function(){return Le},fetchDocs:function(){var e=this;Le.getStudentDocs(this.num).then((function(t){e.docs=t.data})).catch((function(e){console.log("Error fetching docs")}))}},mounted:function(){w.isEtudiant()?this.num=w.numero:this.num=this.$route.params.num,this.fetchDocs()}},En=(0,S.A)(Dn,[["render",function(e,t,n,o,a,s){var i=this;return null!==this.docs&&Object.keys(a.docs.data).length>0?((0,r.uX)(),(0,r.CE)("div",sn,[(0,r.Lk)("div",ln,[un,(0,r.Lk)("h5",null,(0,r.v_)(this.docs.student.nom)+" "+(0,r.v_)(this.docs.student.prenom)+" ("+(0,r.v_)(this.docs.student.numero)+")",1)]),(0,r.Lk)("div",cn,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(Object.keys(a.docs.data).reverse(),(function(e,t){return(0,r.uX)(),(0,r.CE)("div",dn,[(0,r.Lk)("h2",{class:"accordion-header",id:"panelsStayOpen-heading"+e},[(0,r.Lk)("button",{class:(0,r.C4)("accordion-button"+(t>0?" collapsed":"")),type:"button","data-bs-toggle":"collapse","data-bs-target":"#panelsStayOpen-collapse"+e,"aria-expanded":0===t,"aria-controls":"panelsStayOpen-collapse"+e},(0,r.v_)(e),11,mn)],8,pn),(0,r.Lk)("div",{id:"panelsStayOpen-collapse"+e,class:(0,r.C4)("accordion-collapse collapse"+(0===t?" show":"")),"aria-labelledby":"panelsStayOpen-heading"+e},[(0,r.Lk)("div",hn,[(0,r.Lk)("div",vn,[(0,r.Lk)("div",{class:(0,r.C4)("col-12 col-lg-6 "+(void 0===a.docs.data[e].rn?"collapse":""))},[bn,(0,r.Lk)("ul",null,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(a.docs.data[e].rn,(function(e){return(0,r.uX)(),(0,r.CE)("li",null,[(0,r.Lk)("a",{href:s.WebService().getDownloadURL(0)+i.num+"/"+e.index,target:"_blank"},(0,r.v_)(e.name),9,gn)])})),256))])],2),(0,r.Lk)("div",{class:(0,r.C4)("col-12 col-lg-6 "+(void 0===a.docs.data[e].attest?"collapse":""))},[yn,(0,r.Lk)("ul",null,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(a.docs.data[e].attest,(function(e){return(0,r.uX)(),(0,r.CE)("li",null,[(0,r.Lk)("a",{href:s.WebService().getDownloadURL(1)+i.num+"/"+e.index,target:"_blank"},(0,r.v_)(e.name),9,kn)])})),256))])],2)])])],10,fn)])})),256))])])):((0,r.uX)(),(0,r.CE)("div",Ln,[(0,r.Lk)("div",wn,[Cn,null!==this.docs?((0,r.uX)(),(0,r.CE)("h5",Sn,(0,r.v_)(this.docs.student.nom)+" "+(0,r.v_)(this.docs.student.prenom)+" ("+(0,r.v_)(this.docs.student.numero)+")",1)):(0,r.Q3)("v-if",!0)]),xn]))}]]);var Rn={class:"container mt-2"},_n=[(0,r.Lk)("div",{class:"row justify-content-md-center alert alert-warning"},[(0,r.Lk)("h5",{style:{"text-align":"center"}},"Vous n'avez pas accès à cette application")],-1)];const An={name:"Unauthorized"},Un=(0,S.A)(An,[["render",function(e,t,n,o,a,s){return(0,r.uX)(),(0,r.CE)("div",Rn,_n)}]]);var Gn={class:"modal fade",id:"addUserModal",tabindex:"-1","aria-labelledby":"addUserModalLabel","aria-hidden":"true"},Tn={class:"modal-dialog modal-xl"},Nn={class:"modal-content"},Fn=(0,r.Lk)("div",{class:"modal-header"},[(0,r.Lk)("h5",{class:"modal-title",id:"addUserModalLabel"},"Ajouter un utilisateur"),(0,r.Lk)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Mn={class:"modal-body"},On={class:"mb-3 d-flex"},Xn={class:"flex-grow-1"},jn=(0,r.Lk)("label",{for:"username",class:"form-label"},"Nom d'utilisateur",-1),In=(0,r.Lk)("div",{class:"ms-2 align-self-end"},[(0,r.Lk)("button",{type:"submit",class:"btn btn-primary"},"Rechercher")],-1),Pn={class:"modal fade",id:"addGroupModal",tabindex:"-1","aria-labelledby":"addGroupModalLabel","aria-hidden":"true"},Bn={class:"modal-dialog modal-xl"},Wn={class:"modal-content"},Qn={class:"modal-header"},qn={class:"modal-title",id:"addGroupModalLabel"},$n=(0,r.Lk)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),Vn={class:"modal-body"},zn={class:"mb-3"},Hn=(0,r.Lk)("label",{for:"groupLibelle",class:"form-label"},"Libellé",-1),Kn={class:"mb-3"},Yn={type:"submit",class:"btn btn-primary"},Jn={class:"container mt-2"},Zn=(0,r.Lk)("ul",{class:"nav nav-tabs",id:"myTab",role:"tablist"},[(0,r.Lk)("li",{class:"nav-item",role:"presentation"},[(0,r.Lk)("button",{class:"nav-link active",id:"tab1-tab","data-bs-toggle":"tab","data-bs-target":"#tab1",type:"button",role:"tab","aria-controls":"tab1","aria-selected":"true"},"Utilisateurs ")]),(0,r.Lk)("li",{class:"nav-item",role:"presentation"},[(0,r.Lk)("button",{class:"nav-link",id:"tab2-tab","data-bs-toggle":"tab","data-bs-target":"#tab2",type:"button",role:"tab","aria-controls":"tab2","aria-selected":"false"},"Groupes ")])],-1),er={class:"tab-content",id:"myTabContent"},tr={class:"tab-pane fade show active",id:"tab1",role:"tabpanel","aria-labelledby":"tab1-tab"},nr=(0,r.Lk)("h3",null,"Liste des utilisateurs",-1),rr=(0,r.Lk)("button",{class:"btn btn-primary","data-bs-toggle":"modal","data-bs-target":"#addUserModal"},"Ajouter",-1),or={class:"tab-pane fade",id:"tab2",role:"tabpanel","aria-labelledby":"tab2-tab"},ar=(0,r.Lk)("h3",null,"Liste des groupes",-1);n(8598),n(2008),n(5086),n(113),n(6412),n(8125),n(4731),n(479),n(9904),n(875),n(1629),n(3500),n(287);function sr(e){return sr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},sr(e)}function ir(){ir=function(){return t};var e,t={},n=Object.prototype,r=n.hasOwnProperty,o=Object.defineProperty||function(e,t,n){e[t]=n.value},a="function"==typeof Symbol?Symbol:{},s=a.iterator||"@@iterator",i=a.asyncIterator||"@@asyncIterator",l=a.toStringTag||"@@toStringTag";function u(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,n){return e[t]=n}}function c(e,t,n,r){var a=t&&t.prototype instanceof b?t:b,s=Object.create(a.prototype),i=new A(r||[]);return o(s,"_invoke",{value:D(e,n,i)}),s}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=c;var p="suspendedStart",m="suspendedYield",f="executing",h="completed",v={};function b(){}function g(){}function y(){}var k={};u(k,s,(function(){return this}));var L=Object.getPrototypeOf,w=L&&L(L(U([])));w&&w!==n&&r.call(w,s)&&(k=w);var C=y.prototype=b.prototype=Object.create(k);function S(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function x(e,t){function n(o,a,s,i){var l=d(e[o],e,a);if("throw"!==l.type){var u=l.arg,c=u.value;return c&&"object"==sr(c)&&r.call(c,"__await")?t.resolve(c.__await).then((function(e){n("next",e,s,i)}),(function(e){n("throw",e,s,i)})):t.resolve(c).then((function(e){u.value=e,s(u)}),(function(e){return n("throw",e,s,i)}))}i(l.arg)}var a;o(this,"_invoke",{value:function(e,r){function o(){return new t((function(t,o){n(e,r,t,o)}))}return a=a?a.then(o,o):o()}})}function D(t,n,r){var o=p;return function(a,s){if(o===f)throw new Error("Generator is already running");if(o===h){if("throw"===a)throw s;return{value:e,done:!0}}for(r.method=a,r.arg=s;;){var i=r.delegate;if(i){var l=E(i,r);if(l){if(l===v)continue;return l}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===p)throw o=h,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=f;var u=d(t,n,r);if("normal"===u.type){if(o=r.done?h:m,u.arg===v)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(o=h,r.method="throw",r.arg=u.arg)}}}function E(t,n){var r=n.method,o=t.iterator[r];if(o===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,E(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),v;var a=d(o,t.iterator,n.arg);if("throw"===a.type)return n.method="throw",n.arg=a.arg,n.delegate=null,v;var s=a.arg;return s?s.done?(n[t.resultName]=s.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,v):s:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,v)}function R(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function _(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(R,this),this.reset(!0)}function U(t){if(t||""===t){var n=t[s];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function n(){for(;++o<t.length;)if(r.call(t,o))return n.value=t[o],n.done=!1,n;return n.value=e,n.done=!0,n};return a.next=a}}throw new TypeError(sr(t)+" is not iterable")}return g.prototype=y,o(C,"constructor",{value:y,configurable:!0}),o(y,"constructor",{value:g,configurable:!0}),g.displayName=u(y,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,u(e,l,"GeneratorFunction")),e.prototype=Object.create(C),e},t.awrap=function(e){return{__await:e}},S(x.prototype),u(x.prototype,i,(function(){return this})),t.AsyncIterator=x,t.async=function(e,n,r,o,a){void 0===a&&(a=Promise);var s=new x(c(e,n,r,o),a);return t.isGeneratorFunction(n)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},S(C),u(C,l,"Generator"),u(C,s,(function(){return this})),u(C,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=U,A.prototype={constructor:A,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(_),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function o(r,o){return i.type="throw",i.arg=t,n.next=r,o&&(n.method="next",n.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var s=this.tryEntries[a],i=s.completion;if("root"===s.tryLoc)return o("end");if(s.tryLoc<=this.prev){var l=r.call(s,"catchLoc"),u=r.call(s,"finallyLoc");if(l&&u){if(this.prev<s.catchLoc)return o(s.catchLoc,!0);if(this.prev<s.finallyLoc)return o(s.finallyLoc)}else if(l){if(this.prev<s.catchLoc)return o(s.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return o(s.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var s=a?a.completion:{};return s.type=e,s.arg=t,a?(this.method="next",this.next=a.finallyLoc,v):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),_(n),v}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;_(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:U(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),v}},t}function lr(e,t,n,r,o,a,s){try{var i=e[a](s),l=i.value}catch(e){return void n(e)}i.done?t(l):Promise.resolve(l).then(r,o)}var ur={template:'<button style="height: 30px;width: 15px" class="btn btn-outline-secondary mt-1" v-if="this.params.render" v-on:click="this.params.onClicked(this.params.data)">\n                 <span :class="this.params.txt"></span>\n            </button>'},cr={template:'<input type="checkbox" :checked="this.params.value" :disabled="this.params.disabled"\n                    v-on:change="this.params.onChanged(this.params.data)">'},dr={template:'<span><a v-for="(grp, index) in this.params.groups" href="#"\n                      @click.prevent="this.params.openGroup(grp)">{{ grp.libelle }}<span\n      v-if="index < this.params.groups.length - 1">, </span></a></span>'};const pr={name:"User",components:{AgGridVue:He.b},data:function(){var e=this;return{users:null,copyUsers:null,searchUsers:null,selectedSearchUser:null,groups:null,newUsername:"",newGroup:{libelle:"",userGroups:[]},userClassRules:{"old-user":function(e){return e.data.old}},defaultColDef:{floatingFilter:!0,sortable:!0,filter:!0,resizable:!0,minWidth:100,editable:!1,flex:1},searchUsersColumnDefs:[{field:"username",headerName:"Pseudo",checkboxSelection:!0},{field:"nom",headerName:"Nom"},{field:"prenom",headerName:"Prénom"},{field:"composante",headerName:"Composante"}],usersColumnDefs:this.getUsersColumnDefs(),groupsColumnDefs:[{field:"libelle",headerName:"Libellé"},{headerName:"Responsables",valueGetter:function(e){return e.data.userGroups.filter((function(e){return e.responsable})).map((function(e){return e.username})).join(", ")}},{headerName:"Utilisateurs",valueGetter:function(e){return e.data.userGroups.filter((function(e){return!e.responsable})).map((function(e){return e.username})).join(", ")}},{headerName:"",cellRenderer:ur,cellRendererParams:{onClicked:function(t){e.newGroup=t,new bootstrap.Modal(document.getElementById("addGroupModal")).show()},txt:"mdi mdi-pencil mdi-24px",render:!0},width:110,minWidth:110,maxWidth:110,floatingFilter:!1},{headerName:"",cellRenderer:ur,cellRendererParams:function(t){return{onClicked:function(n){console.log(t),e.deleteGroup(n)},txt:"mdi mdi-delete mdi-24px",render:!0}},width:110,minWidth:110,maxWidth:110,floatingFilter:!1}],groupUsersColumnDefs:this.getGroupUsersColumnDefs()}},watch:{newGroup:{handler:function(e,t){console.log("newGroup changed => getGroupUsersColumnDefs"),this.groupUsersColumnDefs=this.getGroupUsersColumnDefs()},deep:!1},users:{handler:function(){var e=this;console.log("users changed => getGroupUsersColumnDefs"),this.$nextTick((function(){e.$refs.usersGrid&&e.$refs.usersGrid.api.setGridOption("rowData",e.users),e.$refs.groupUsersGrid&&e.$refs.groupUsersGrid.api.setGridOption("rowData",e.users)}))},deep:!0}},methods:{getUsersColumnDefs:function(){var e=this;return[{field:"username",headerName:"Pseudo"},{field:"nom",headerName:"Nom"},{field:"prenom",headerName:"Prénom"},{field:"composante",headerName:"Composante"},{headerName:"Responsable dans groupe",cellRenderer:dr,cellRendererParams:function(t){return{openGroup:function(t){console.log(t),e.newGroup=t,new bootstrap.Modal(document.getElementById("addGroupModal")).show()},groups:e.groups.filter((function(e){return e.userGroups.some((function(e){return e.responsable&&e.username===t.data.username}))}))}}},{headerName:"Utilisateur dans groupe",cellRenderer:dr,cellRendererParams:function(t){return{openGroup:function(t){console.log(t),e.newGroup=t,new bootstrap.Modal(document.getElementById("addGroupModal")).show()},groups:e.groups.filter((function(e){return e.userGroups.some((function(e){return e.user&&e.username===t.data.username}))}))}}},{headerName:"",cellRenderer:ur,cellRendererParams:function(t){return{onClicked:function(t){e.deleteUser(t)},txt:"mdi mdi-delete mdi-24px",render:!t.data.old}},width:110,minWidth:110,maxWidth:110,floatingFilter:!1}]},getGroupUsersColumnDefs:function(){var e=this;return console.log("getGroupUsersColumnDefs"),[{field:"username",headerName:"Pseudo"},{headerName:"Nom",valueGetter:function(t){var n;return(null===(n=e.users.find((function(e){return e.username===t.data.username})))||void 0===n?void 0:n.nom)||""}},{headerName:"Prénom",valueGetter:function(t){var n;return(null===(n=e.users.find((function(e){return e.username===t.data.username})))||void 0===n?void 0:n.prenom)||""}},{headerName:"Composante",valueGetter:function(t){var n;return(null===(n=e.users.find((function(e){return e.username===t.data.username})))||void 0===n?void 0:n.composante)||""}},{headerName:"Responsable",cellRenderer:cr,cellRendererParams:function(t){return{onChanged:function(t){var n=e.newGroup.userGroups.find((function(e){return e.username===t.username}));void 0!==n?(n.responsable=!n.responsable,n.responsable||n.user||(e.newGroup.userGroups=e.newGroup.userGroups.filter((function(e){return e.username!==t.username})))):e.newGroup.userGroups.push({id:t.id,username:t.username,responsable:!0,user:!1}),e.$refs.groupUsersGrid.api.refreshCells()},value:e.newGroup.userGroups.some((function(e){return e.responsable&&e.username===t.data.username})),disabled:e.newGroup.userGroups.some((function(e){return e.user&&e.username===t.data.username}))||e.users.some((function(e){return e.username===t.data.username&&e.old}))}},comparator:function(t,n,r,o,a){var s=e.newGroup.userGroups.some((function(e){return e.responsable&&e.username===r.data.username}));return s===e.newGroup.userGroups.some((function(e){return e.responsable&&e.username===o.data.username}))?0:s?-1:1}},{headerName:"Utilisateur",cellRenderer:cr,cellRendererParams:function(t){return{onChanged:function(t){var n=e.newGroup.userGroups.find((function(e){return e.username===t.username}));void 0!==n?(n.user=!n.user,n.responsable||n.user||(e.newGroup.userGroups=e.newGroup.userGroups.filter((function(e){return e.username!==t.username})))):e.newGroup.userGroups.push({id:t.id,username:t.username,responsable:!1,user:!0}),e.$refs.groupUsersGrid.api.refreshCells()},value:e.newGroup.userGroups.some((function(e){return e.user&&e.username===t.data.username})),disabled:e.newGroup.userGroups.some((function(e){return e.responsable&&e.username===t.data.username}))}},comparator:function(t,n,r,o,a){var s=e.newGroup.userGroups.some((function(e){return e.user&&e.username===r.data.username}));return s===e.newGroup.userGroups.some((function(e){return e.user&&e.username===o.data.username}))?0:s?-1:1}}]},openGroupModal:function(){this.newGroup={libelle:"",userGroups:[]}},onSearchUsersSelectionChanged:function(e){this.selectedSearchUser=e.api.getSelectedRows()[0],console.log(this.selectedSearchUser)},findUsers:function(){var e=this;Le.findUsers(this.newUsername).then((function(t){e.searchUsers=t.data})).catch((function(e){Ce("Erreur lors de la récupération des utilisateurs","short_error")}))},fetchUsers:function(){var e=this;Le.getUsers().then((function(t){e.users=t.data})).catch((function(e){Ce("Erreur lors de la récupération des utilisateurs","short_error")}))},deleteUser:function(e){var t=this;confirm("Voulez-vous vraiment supprimer l'utilisateur ["+e.username+"] ?")&&Le.deleteUser(e.id).then((function(n){Ce("Utilisateur ["+e.username+"] supprimé","short_success"),n.data.old?t.users.find((function(t){return t.username===e.username})).old=!0:t.users=t.users.filter((function(t){return t.username!==e.username})),t.fetchGroups()})).catch((function(e){Ce("Erreur lors de la suppression de l'utilisateur","short_error")}))},addUser:function(){var e=this;Le.addUser(this.selectedSearchUser.username).then((function(t){Ce("Utilisateur ["+e.newUsername+"] ajouté","short_success");var n=e.users.find((function(e){return e.username===t.data.username}));n?(n.old=!1,n.id=t.data.id):e.users.push(t.data),e.newUsername="",bootstrap.Modal.getInstance(document.getElementById("addUserModal")).hide()})).catch((function(e){console.log(e.response.data.message),Ce(e.response.data.message,"short_error")}))},fetchGroups:function(){var e=this;return Le.getGroups().then((function(t){e.groups=t.data})).catch((function(e){Ce("Erreur lors de la récupération des groupes","short_error")}))},deleteGroup:function(e){var t=this;confirm("Voulez-vous vraiment supprimer le groupe ["+e.libelle+"] ?")&&Le.deleteGroup(e.id).then((function(n){Ce("Groupe ["+e.libelle+"] supprimé","short_success"),t.groups=t.groups.filter((function(t){return t.id!==e.id})),t.$refs.usersGrid.api.refreshCells()})).catch((function(e){Ce("Erreur lors de la suppression du groupe","short_error")}))},addGroup:function(){var e=this;console.log(this.newGroup),Le.addGroup(this.newGroup).then((function(t){Ce("Groupe ["+e.newGroup.libelle+"] ajouté","short_success"),void 0===e.newGroup.id&&e.groups.push(t.data),e.$refs.usersGrid.api.refreshCells(),bootstrap.Modal.getInstance(document.getElementById("addGroupModal")).hide()})).catch((function(e){console.log(e.response.data.message),void 0!==e.response.data.message?Ce(e.response.data.message,"short_error"):Ce("Erreur","short_error")}))}},beforeMount:function(){var e,t=this;return(e=ir().mark((function e(){return ir().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.fetchGroups();case 2:t.fetchUsers();case 3:case"end":return e.stop()}}),e)})),function(){var t=this,n=arguments;return new Promise((function(r,o){var a=e.apply(t,n);function s(e){lr(a,r,o,s,i,"next",e)}function i(e){lr(a,r,o,s,i,"throw",e)}s(void 0)}))})()}},mr=(0,S.A)(pr,[["render",function(e,t,n,o,a,s){var i=this,l=(0,r.g2)("ag-grid-vue");return(0,r.uX)(),(0,r.CE)(r.FK,null,[(0,r.Q3)(" Modal USER "),(0,r.Lk)("div",Gn,[(0,r.Lk)("div",Tn,[(0,r.Lk)("div",Nn,[Fn,(0,r.Lk)("div",Mn,[(0,r.Lk)("form",{onSubmit:t[1]||(t[1]=(0,r.D$)((function(e){return i.findUsers()}),["prevent"]))},[(0,r.Lk)("div",On,[(0,r.Lk)("div",Xn,[jn,(0,r.bo)((0,r.Lk)("input",{type:"text",class:"form-control",placeholder:"identifiant | nom",id:"username","onUpdate:modelValue":t[0]||(t[0]=function(e){return a.newUsername=e}),required:""},null,512),[[r.Jo,a.newUsername]])]),In])],32),null!==a.searchUsers?((0,r.uX)(),(0,r.Wv)(l,{key:0,class:"ag-theme-alpine mt-1",style:{height:"60vh"},columnDefs:a.searchUsersColumnDefs,rowData:this.searchUsers,defaultColDef:a.defaultColDef,pagination:"true",animateRows:"true",ensureDomOrder:!0,localeText:{noRowsToShow:"Aucune donnée à afficher"},enableCellTextSelection:!0,rowSelection:"single",onSelectionChanged:s.onSearchUsersSelectionChanged,suppressRowClickSelection:!0},null,8,["columnDefs","rowData","defaultColDef","onSelectionChanged"])):(0,r.Q3)("v-if",!0),null!==a.selectedSearchUser?((0,r.uX)(),(0,r.CE)("button",{key:1,class:"btn btn-primary mt-1",onClick:t[2]||(t[2]=function(e){return i.addUser()})},"Ajouter ")):(0,r.Q3)("v-if",!0)])])])]),(0,r.Q3)(" Modal GROUP "),(0,r.Lk)("div",Pn,[(0,r.Lk)("div",Bn,[(0,r.Lk)("div",Wn,[(0,r.Lk)("div",Qn,[(0,r.Lk)("h5",qn,(0,r.v_)(void 0===this.newGroup.id?"Ajouter un groupe":"Mettre à jour le groupe"),1),$n]),(0,r.Lk)("div",Vn,[(0,r.Lk)("form",{onSubmit:t[4]||(t[4]=(0,r.D$)((function(e){return i.addGroup()}),["prevent"]))},[(0,r.Lk)("div",zn,[Hn,(0,r.bo)((0,r.Lk)("input",{type:"text",class:"form-control",id:"groupLibelle","onUpdate:modelValue":t[3]||(t[3]=function(e){return a.newGroup.libelle=e}),required:""},null,512),[[r.Jo,a.newGroup.libelle]])]),(0,r.Lk)("div",Kn,[(0,r.bF)(l,{class:"ag-theme-alpine",ref:"groupUsersGrid",style:{height:"400px",width:"100%"},columnDefs:a.groupUsersColumnDefs,rowData:this.users,defaultColDef:a.defaultColDef,pagination:"true",animateRows:"true",rowClassRules:this.userClassRules,ensureDomOrder:!0,localeText:{noRowsToShow:"Aucune donnée à afficher"},enableCellTextSelection:!0},null,8,["columnDefs","rowData","defaultColDef","rowClassRules"])]),(0,r.Lk)("button",Yn,(0,r.v_)(void 0===this.newGroup.id?"Ajouter":"Mettre à jour"),1)],32)])])])]),(0,r.Lk)("div",Jn,[Zn,(0,r.Lk)("div",er,[(0,r.Lk)("div",tr,[nr,rr,null!==a.users?((0,r.uX)(),(0,r.Wv)(l,{key:0,ref:"usersGrid",class:"ag-theme-alpine mt-1",style:{height:"60vh"},columnDefs:a.usersColumnDefs,rowData:this.users,defaultColDef:a.defaultColDef,pagination:"true",animateRows:"true",ensureDomOrder:!0,rowClassRules:this.userClassRules,localeText:{noRowsToShow:"Aucune donnée à afficher"},enableCellTextSelection:!0},null,8,["columnDefs","rowData","defaultColDef","rowClassRules"])):(0,r.Q3)("v-if",!0)]),(0,r.Lk)("div",or,[ar,(0,r.Lk)("button",{class:"btn btn-primary","data-bs-toggle":"modal",onClick:t[5]||(t[5]=function(e){return s.openGroupModal()}),"data-bs-target":"#addGroupModal"},"Ajouter "),(0,r.bF)(l,{class:"ag-theme-alpine mt-1",ref:"groupsGrid",style:{height:"60vh"},columnDefs:a.groupsColumnDefs,rowData:a.groups,defaultColDef:a.defaultColDef,pagination:"true",animateRows:"true",ensureDomOrder:!0,localeText:{noRowsToShow:"Aucune donnée à afficher"},enableCellTextSelection:!0},null,8,["columnDefs","rowData","defaultColDef"])])])])],64)}]]);var fr=document.querySelector("#app").dataset.info,hr=JSON.parse(atob(fr));w.setName(hr.username),w.setRoles(hr.roles),w.setEncryptedName(hr.encryptedUsername),w.setNumero(hr.numero);var vr=[{path:"/scola",component:Q,meta:{requiresScola:!0}},{path:"/users",component:mr,meta:{requiresAdmin:!0}},{path:"/scola/import/rn",component:Ct,meta:{requiresScola:!0},props:{mode:0}},{path:"/scola/import/attest",component:Ct,meta:{requiresScola:!0},props:{mode:1}},{path:"/scola/monitoring/rn",component:Vt,meta:{requiresScola:!0},props:{mode:0}},{path:"/scola/monitoring/attest",component:Vt,meta:{requiresScola:!0},props:{mode:1}},{path:"/scola/search",component:an,meta:{requiresScola:!0}},{path:"/student/:num*",component:En,meta:{requiresScola:!1}},{path:"/unauthorized",component:Un,meta:{requiresScola:!1}},{path:"/:pathMatch(.*)*",redirect:"/scola"}],br=(0,E.aE)({history:(0,E.LA)(),routes:vr});be.A.interceptors.response.use((function(e){return e}),(function(e){return console.log("AXIOS ERR"),Promise.reject(e)})),br.beforeEach((function(e,t,n){w.isEtudiant()&&"/student"!==e.path?n({path:"/student"}):w.isAnonym()&&"/unauthorized"!==e.path?n({path:"/unauthorized"}):w.isAnonym()||"/unauthorized"!==e.path?e.meta.requiresScola?w.isScola()?n():n({path:"/"}):e.meta.requiresAdmin?w.isAdmin()?n():n({path:"/"}):n():n({path:"/"})}));var gr=(0,r.Ef)(D,{url_login:hr.url_login,url_logout:hr.url_logout});gr.config.compilerOptions.isCustomElement=function(e){return e.startsWith("uca-")},gr.use(br).mount("#app")}},e=>{e.O(0,[620],(()=>{return t=5870,e(e.s=t);var t}));e.O()}]);
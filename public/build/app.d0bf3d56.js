"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[524],{4991:(e,t,n)=>{n(9432),n(6918),n(2945),n(5815),n(4979),n(9739),n(6099),n(3362),n(1392);var a=n(1425);var o=function(e){return(0,a.Qi)("data-v-7233546c"),e=e(),(0,a.jt)(),e},r={ref:"depot-nav",class:"navbar navbar-expand-lg navbar-dark bg-primary",style:{"box-shadow":"0px 5px 10px 0px #9c9c9c",height:"50px"}},i={class:"container-fluid",style:{margin:"0 5px",padding:"0"}},s={class:"d-flex align-items-center gap-2 text-white",style:{margin:"0 5px",padding:"0 3px"}},l=o((function(){return(0,a.Lk)("span",{type:"button",id:"btnMenuEnt",class:"mdi mdi-dots-grid",style:{"font-size":"28px","margin-right":"2px"}},null,-1)})),c={key:1,class:"navbar-brand",href:"#"},u={key:0,class:"navbar-toggler",type:"button","data-bs-toggle":"collapse","data-bs-target":"#navbarSupportedContent","aria-controls":"navbarSupportedContent","aria-expanded":"false","aria-label":"Toggle navigation"},d=[o((function(){return(0,a.Lk)("span",{class:"navbar-toggler-icon"},null,-1)}))],p={class:"collapse navbar-collapse",id:"navbarSupportedContent"},m={class:"navbar-nav me-auto mb-2 mb-lg-0"},f={key:0,class:"nav-item dropdown"},h=o((function(){return(0,a.Lk)("a",{class:"nav-link dropdown-toggle",href:"#",role:"button","data-bs-toggle":"dropdown","aria-expanded":"false"}," Relevés ",-1)})),v={class:"dropdown-menu"},b={key:1,class:"nav-item dropdown"},g=o((function(){return(0,a.Lk)("a",{class:"nav-link dropdown-toggle",href:"#",role:"button","data-bs-toggle":"dropdown","aria-expanded":"false"}," Attestations ",-1)})),y={class:"dropdown-menu"},k={key:2,class:"nav-item"};n(2010),n(4423),n(1699);var L=(0,a.Kh)({name:"",encryptedName:"",roles:[],numero:"",setName:function(e){this.name=e},setEncryptedName:function(e){this.encryptedName=e},setRoles:function(e){this.roles=e},setNumero:function(e){this.numero=e},asRole:function(e){return this.roles.includes(e)},isAdmin:function(){return this.asRole("ROLE_ADMIN")},isEtudiant:function(){return this.asRole("ROLE_ETUDIANT")},isAnonym:function(){return this.asRole("ROLE_ANONYMOUS")},isScola:function(){return this.isAdmin()||this.asRole("ROLE_SCOLA")}});const S={name:"Header",data:function(){return{navHeight:0}},computed:{user:function(){return L}},props:{url_login:String,url_logout:String},methods:{},mounted:function(){this.navHeight=this.$refs["depot-nav"].offsetHeight+1}};var C=n(6262);const w={name:"App",components:{Header:(0,C.A)(S,[["render",function(e,t,n,o,L,S){var C=(0,a.g2)("router-link"),w=(0,a.g2)("uca-menu");return(0,a.uX)(),(0,a.CE)(a.FK,null,[(0,a.Lk)("nav",r,[(0,a.Lk)("div",i,[(0,a.Lk)("div",s,[l,S.user.isScola()?((0,a.uX)(),(0,a.Wv)(C,{key:0,class:"text-decoration-none text-white",to:"/scola"},{default:(0,a.k6)((function(){return[(0,a.eW)("Doc Scola")]})),_:1})):((0,a.uX)(),(0,a.CE)("a",c,"Doc Scola"))]),S.user.isScola()?((0,a.uX)(),(0,a.CE)("button",u,d)):(0,a.Q3)("v-if",!0),(0,a.Lk)("div",p,[(0,a.Lk)("ul",m,[S.user.isScola()?((0,a.uX)(),(0,a.CE)("li",f,[h,(0,a.Lk)("ul",v,[(0,a.Lk)("li",null,[(0,a.bF)(C,{class:"dropdown-item",to:"/scola/import/rn"},{default:(0,a.k6)((function(){return[(0,a.eW)("Import")]})),_:1})]),(0,a.Lk)("li",null,[(0,a.bF)(C,{class:"dropdown-item",to:"/scola/monitoring/rn"},{default:(0,a.k6)((function(){return[(0,a.eW)("Suivi")]})),_:1})])])])):(0,a.Q3)("v-if",!0),S.user.isScola()?((0,a.uX)(),(0,a.CE)("li",b,[g,(0,a.Lk)("ul",y,[(0,a.Lk)("li",null,[(0,a.bF)(C,{class:"dropdown-item",to:"/scola/import/attest"},{default:(0,a.k6)((function(){return[(0,a.eW)("Import")]})),_:1})]),(0,a.Lk)("li",null,[(0,a.bF)(C,{class:"dropdown-item",to:"/scola/monitoring/attest"},{default:(0,a.k6)((function(){return[(0,a.eW)("Suivi")]})),_:1})])])])):(0,a.Q3)("v-if",!0),S.user.isScola()?((0,a.uX)(),(0,a.CE)("li",k,[(0,a.bF)(C,{"active-class":"active",class:"nav-link","aria-current":"page",to:"/scola/search"},{default:(0,a.k6)((function(){return[(0,a.eW)("Recherche étudiant ")]})),_:1})])):(0,a.Q3)("v-if",!0)])])])],512),(0,a.bF)(w,{"data-opener":"btnMenuEnt","data-opener-class":"text-info","data-toggle-outside":"true","data-top":L.navHeight,"data-client":"DOCSCOLA","data-connected":S.user.encryptedName,"data-path-login":n.url_login,"data-path-logout":n.url_logout},null,8,["data-top","data-connected","data-path-login","data-path-logout"])],64)}],["__scopeId","data-v-7233546c"]])},props:{url_login:String,url_logout:String}},x=(0,C.A)(w,[["render",function(e,t,n,o,r,i){var s=(0,a.g2)("Header"),l=(0,a.g2)("router-view");return(0,a.uX)(),(0,a.CE)(a.FK,null,[(0,a.bF)(s,{url_login:n.url_login,url_logout:n.url_logout},null,8,["url_login","url_logout"]),(0,a.bF)(l)],64)}]]);var D=n(9351),_={class:"container"},E=(0,a.Lk)("div",{class:"row justify-content-md-center"},[(0,a.Lk)("h2",null,"Gestion des documents de scolarité")],-1),R={style:{"margin-top":"40px"},class:"row"},A={class:"col-sm"},T={class:"card text-white bg-primary"},F=(0,a.Lk)("div",{class:"card-header"},"Relevés de notes",-1),N={class:"card-body"},M={style:{"text-align":"center"}},U={style:{"text-align":"center"}},X={class:"col-sm"},O={class:"card text-white bg-primary"},I=(0,a.Lk)("div",{class:"card-header"},"Attestations de réussite",-1),B={class:"card-body"},j={style:{"text-align":"center"}},Q={style:{"text-align":"center"}};const q={name:"HomeScola"},P=(0,C.A)(q,[["render",function(e,t,n,o,r,i){var s=(0,a.g2)("router-link");return(0,a.uX)(),(0,a.CE)("div",_,[E,(0,a.Lk)("div",R,[(0,a.Lk)("div",A,[(0,a.Lk)("div",T,[F,(0,a.Lk)("div",N,[(0,a.Lk)("h2",M,[(0,a.bF)(s,{class:"btn btn-secondary",to:"/scola/import/rn"},{default:(0,a.k6)((function(){return[(0,a.eW)("Importer des relevés de notes ")]})),_:1})]),(0,a.Lk)("h2",U,[(0,a.bF)(s,{class:"btn btn-secondary",to:"/scola/monitoring/rn"},{default:(0,a.k6)((function(){return[(0,a.eW)("Suivi du dépôt des relevés de notes ")]})),_:1})])])])]),(0,a.Lk)("div",X,[(0,a.Lk)("div",O,[I,(0,a.Lk)("div",B,[(0,a.Lk)("h2",j,[(0,a.bF)(s,{class:"btn btn-secondary",to:"/scola/import/attest"},{default:(0,a.k6)((function(){return[(0,a.eW)("Importer des attestations de réussite ")]})),_:1})]),(0,a.Lk)("h2",Q,[(0,a.bF)(s,{class:"btn btn-secondary",to:"/scola/monitoring/attest"},{default:(0,a.k6)((function(){return[(0,a.eW)("Suivi du dépôt des attestations de réussite ")]})),_:1})])])])])])])}]]);var W={class:"container"},V={style:{"--bs-breadcrumb-divider":"'>'"},"aria-label":"breadcrumb"},z={class:"breadcrumb"};n(2892),n(4114);var H=function(e){return(0,a.Qi)("data-v-ce5c734c"),e=e(),(0,a.jt)(),e},G={key:0},K={key:1},$={class:"mb-3"},Y={for:"input_rn",class:"form-label"},J={class:"mb-3"},Z=H((function(){return(0,a.Lk)("label",{for:"input_etu",class:"form-label"},"Fichier ETU",-1)})),ee={key:0,class:"mb-3"},te=H((function(){return(0,a.Lk)("label",{for:"select_sem",class:"form-label"},"Semestre",-1)})),ne=[(0,a.Fv)("<option data-v-ce5c734c>1</option><option data-v-ce5c734c>2</option><option data-v-ce5c734c>A</option><option data-v-ce5c734c>1p1</option><option data-v-ce5c734c>1p2</option><option data-v-ce5c734c>1p3</option><option data-v-ce5c734c>2p1</option><option data-v-ce5c734c>2p2</option><option data-v-ce5c734c>2p3</option><option data-v-ce5c734c>Ap1</option><option data-v-ce5c734c>Ap2</option><option data-v-ce5c734c>Ap3</option>",12)],ae={key:1,class:"mb-3"},oe=H((function(){return(0,a.Lk)("label",{for:"select_sess",class:"form-label"},"Session",-1)})),re=[H((function(){return(0,a.Lk)("option",null,"1",-1)})),H((function(){return(0,a.Lk)("option",null,"2",-1)})),H((function(){return(0,a.Lk)("option",null,"U",-1)}))],ie={key:2,class:"mb-3"},se=H((function(){return(0,a.Lk)("label",{for:"txt_lib",class:"form-label"},"Libellé",-1)})),le={class:"mb-3"},ce=H((function(){return(0,a.Lk)("label",{for:"input_tampon",class:"form-label"},"Tampon",-1)})),ue={class:"mb-3"},de=H((function(){return(0,a.Lk)("label",{for:"txt_tampon",class:"form-label"},"Numéro de page d'exemple pour tampon",-1)})),pe=["disabled"],me=["disabled"],fe={key:2,class:"text-center"},he=[H((function(){return(0,a.Lk)("div",{class:"lds-ripple"},[(0,a.Lk)("div"),(0,a.Lk)("div")],-1)}))];n(8706),n(5700),n(9572),n(2675),n(9463),n(6280),n(4185),n(2259),n(3792),n(7764),n(2953);var ve=n(1083);function be(e){return be="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},be(e)}function ge(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,ye(a.key),a)}}function ye(e){var t=function(e,t){if("object"!=be(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var a=n.call(e,t||"default");if("object"!=be(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==be(t)?t:String(t)}const ke=new(function(){function e(){var t,n,a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t=this,a="",(n=ye(n="BASE_URL"))in t?Object.defineProperty(t,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[n]=a}var t,n,a;return t=e,(n=[{key:"getMonitoring",value:function(e){return 0===e?ve.A.get(this.BASE_URL+"/api/monitoring/rn"):ve.A.get(this.BASE_URL+"/api/monitoring/attest")}},{key:"searchStudent",value:function(e){return ve.A.post(this.BASE_URL+"/api/scola/search",e)}},{key:"getStudentDocs",value:function(e){return ve.A.get(this.BASE_URL+"/api/etudiant/"+e)}},{key:"importRn",value:function(e,t){var n=new FormData;return n.append("pdf",t.pdf),n.append("etu",t.etu),n.append("sem",t.sem),n.append("sess",t.sess),n.append("lib",t.lib),n.append("tampon",t.tampon),n.append("numTampon",t.numTampon),0===e?ve.A.post(this.BASE_URL+"/api/import/rn",n,{headers:{"Content-Type":"multipart/form-data"}}):ve.A.post(this.BASE_URL+"/api/import/attests",n,{headers:{"Content-Type":"multipart/form-data"}})}},{key:"truncate",value:function(e,t){return ve.A.post(this.BASE_URL+"/api/import/truncate_unit",{page:e,mode:t})}},{key:"getSelection",value:function(e){return 0===e?ve.A.get(this.BASE_URL+"/api/selection/rn"):ve.A.get(this.BASE_URL+"/api/selection/attest")}},{key:"transfertRn",value:function(e,t){return ve.A.post(this.BASE_URL+"/api/transfert/releves",{nums:e,mode:t})}},{key:"fetchMailTemplate",value:function(){return ve.A.get(this.BASE_URL+"/api/transfert/mail/template")}},{key:"sendMail",value:function(e,t){return ve.A.post(this.BASE_URL+"/api/transfert/mail",{ids:e,mode:t})}},{key:"getTamponExample",value:function(e){return ve.A.get(this.BASE_URL+"/api/get_tampon_example/"+e,{responseType:"blob"})}},{key:"applyTampon",value:function(e,t){return ve.A.post(this.BASE_URL+"/api/apply_tampon",{dx:e,dy:t})}},{key:"fetchRnFiles",value:function(e){return ve.A.get(this.BASE_URL+"/api/import/imported/"+e)}},{key:"removeFiles",value:function(e,t){return ve.A.post(this.BASE_URL+"/api/monitoring/delete",{dataId:e,numsEtu:t})}},{key:"sendMails",value:function(e){return ve.A.post(this.BASE_URL+"/api/transfert/mail",{numsEtu:e,mode:0})}},{key:"getDownloadURL",value:function(e){return 0===e?this.BASE_URL+"/api/etudiant/download/releve/":this.BASE_URL+"/api/etudiant/download/attest/"}},{key:"getSrcTampon",value:function(){return this.BASE_URL+"/api/get_tampon/"}},{key:"getPreviewTmpRn",value:function(e){return this.BASE_URL+"/preview/tmp/releves/"+e}},{key:"getPreviewTmpAttest",value:function(e){return this.BASE_URL+"/preview/tmp/attests/"+e}},{key:"getPreviewRn",value:function(e,t){return this.BASE_URL+"/preview/releves/".concat(e,"/").concat(t)}},{key:"getPreviewAttest",value:function(e,t){return this.BASE_URL+"/preview/attests/".concat(e,"/").concat(t)}},{key:"rebuild",value:function(e){return ve.A.get(this.BASE_URL+"/api/selection/rebuild/".concat(e),{responseType:"blob"})}}])&&ge(t.prototype,n),a&&ge(t,a),Object.defineProperty(t,"prototype",{writable:!1}),e}());var Le=new(n(8549).zT)({duration:3e3,position:{x:"right",y:"top"},types:[{type:"file_imported",background:"#006d82",icon:!1,position:{x:"right",y:"bottom"},duration:5e3},{type:"short_success",background:"#006d82",icon:!1,position:{x:"right",y:"bottom"},duration:2500},{type:"error",background:"#d60550",icon:!1,position:{x:"right",y:"bottom"},duration:5e3},{type:"short_error",background:"#d60550",icon:!1,position:{x:"right",y:"bottom"},duration:2500}]});function Se(e,t){Le.open({type:t,message:e})}const Ce={name:"Import",emits:["imported"],props:{mode:Number},data:function(){return{rn:{pdf:"",etu:"",sem:0===this.mode?"1":"",sess:0===this.mode?"1":"",lib:"",tampon:"",numTampon:1},canSubmit:!0}},methods:{importRn:function(e){var t=this;this.canSubmit=!1,ke.importRn(this.mode,this.rn).then((function(e){t.$emit("imported",e.data)})).catch((function(e){console.log(e.response.data.error),void 0!==e.response.data.error?Se(e.response.data.error,"error"):Se("Une erreur est survenue lors de l'importation du relevé de notes","error"),console.log(e),t.canSubmit=!0}))},onPdfFileChange:function(e){this.rn.pdf=e.target.files[0]},onEtuFileChange:function(e){this.rn.etu=e.target.files[0]},onTamponFileChange:function(e){this.rn.tampon=e.target.files[0]}},mounted:function(){},watch:{mode:function(){this.rn.sem=0===this.mode?"1":"",this.rn.sess=0===this.mode?"1":"",this.rn.pdf="",document.getElementById("input_rn").value="",this.rn.etu="",document.getElementById("input_etu").value="",this.rn.tampon="",document.getElementById("input_tampon").value="",this.rn.numTampon=1}}},we=(0,C.A)(Ce,[["render",function(e,t,n,o,r,i){var s=this;return(0,a.uX)(),(0,a.CE)(a.FK,null,[0===n.mode?((0,a.uX)(),(0,a.CE)("h3",G,"Extraction des relevés de notes")):(0,a.Q3)("v-if",!0),1===n.mode?((0,a.uX)(),(0,a.CE)("h3",K,"Extraction des attestations de réussite")):(0,a.Q3)("v-if",!0),(0,a.Lk)("form",{class:"mt-3",onSubmit:t[7]||(t[7]=(0,a.D$)((function(e){return s.importRn()}),["prevent"]))},[(0,a.Lk)("div",$,[(0,a.Lk)("label",Y,(0,a.v_)(0===this.mode?"Relevé de notes":"Attestation"),1),(0,a.Lk)("input",{type:"file",accept:"application/pdf",required:"",onChange:t[0]||(t[0]=function(e){return i.onPdfFileChange(e)}),class:"form-control",id:"input_rn"},null,32)]),(0,a.Lk)("div",J,[Z,(0,a.Lk)("input",{type:"file",accept:".etu",required:"",onChange:t[1]||(t[1]=function(e){return i.onEtuFileChange(e)}),class:"form-control",id:"input_etu"},null,32)]),0===n.mode?((0,a.uX)(),(0,a.CE)("div",ee,[te,(0,a.bo)((0,a.Lk)("select",{id:"select_sem",required:"",class:"form-select","onUpdate:modelValue":t[2]||(t[2]=function(e){return s.rn.sem=e})},ne,512),[[a.u1,this.rn.sem]])])):(0,a.Q3)("v-if",!0),0===n.mode?((0,a.uX)(),(0,a.CE)("div",ae,[oe,(0,a.bo)((0,a.Lk)("select",{id:"select_sess",required:"",class:"form-select","onUpdate:modelValue":t[3]||(t[3]=function(e){return s.rn.sess=e})},re,512),[[a.u1,this.rn.sess]])])):(0,a.Q3)("v-if",!0),0===n.mode?((0,a.uX)(),(0,a.CE)("div",ie,[se,(0,a.bo)((0,a.Lk)("input",{type:"text",required:"","onUpdate:modelValue":t[4]||(t[4]=function(e){return s.rn.lib=e}),class:"form-control",id:"txt_lib"},null,512),[[a.Jo,this.rn.lib]])])):(0,a.Q3)("v-if",!0),(0,a.Lk)("div",le,[ce,(0,a.Lk)("input",{type:"file",accept:".png",onChange:t[5]||(t[5]=function(e){return i.onTamponFileChange(e)}),class:"form-control",id:"input_tampon"},null,32)]),(0,a.Lk)("div",ue,[de,(0,a.bo)((0,a.Lk)("input",{type:"number",min:"1",required:"","onUpdate:modelValue":t[6]||(t[6]=function(e){return s.rn.numTampon=e}),disabled:""===this.rn.tampon,class:"form-control",id:"txt_tampon"},null,8,pe),[[a.Jo,this.rn.numTampon]])]),(0,a.Lk)("button",{type:"submit",class:"btn btn-primary",disabled:!r.canSubmit},"Charger",8,me)],32),r.canSubmit?(0,a.Q3)("v-if",!0):((0,a.uX)(),(0,a.CE)("div",fe,he))],64)}],["__scopeId","data-v-ce5c734c"]]);var xe=(0,a.Lk)("div",{style:{"text-align":"center"}},[(0,a.Lk)("h2",{style:{display:"inline-block",margin:"0 auto"}},"Découpage du document PDF")],-1),De={class:"row justify-content-md-center",id:"pg_container",style:{"margin-top":"17px","margin-bottom":"17px",width:"100%"}},_e={class:"progress",style:{width:"75%",height:"35px"}},Ee=["aria-valuenow"];n(761);const Re={name:"Truncate",emits:["truncated"],props:{pageCount:0,pageIndex:0,mode:Number},data:function(){return{percent:0}},methods:{callTruncate:function(e){var t=this;ke.truncate(e,this.mode).then((function(e){var n=e.data;n>0?(t.percent=Math.trunc((n-1)/t.pageCount*100),t.callTruncate(n)):t.$emit("truncated")})).catch((function(e){console.log("fail")}))}},mounted:function(){this.callTruncate(this.pageIndex)}},Ae=(0,C.A)(Re,[["render",function(e,t,n,o,r,i){return(0,a.uX)(),(0,a.CE)(a.FK,null,[xe,(0,a.Lk)("div",De,[(0,a.Lk)("div",_e,[(0,a.Lk)("div",{class:"progress-bar progress-bar-striped progress-bar-animated",id:"truncate_pg",role:"progressbar","aria-valuenow":r.percent,"aria-valuemin":"0","aria-valuemax":"100",style:(0,a.Tr)({width:r.percent+"%",visibility:"visible",height:"35px"})},(0,a.v_)(r.percent)+"% ",13,Ee)])])],64)}]]);var Te={key:0,class:"mt-2 row justify-content-md-center"},Fe={key:0,class:"form-group col-sm-2"},Ne=(0,a.Lk)("label",{class:"control-label"},"Semestre",-1),Me={key:1,class:"form-group col-sm-2"},Ue=(0,a.Lk)("label",{class:"control-label"},"Session",-1),Xe={class:"form-group col-sm-2"},Oe=(0,a.Lk)("label",{class:"control-label"},"Libellé",-1),Ie=["value"],Be={class:"form-group col-sm-2"},je=(0,a.Lk)("label",{class:"control-label"},"Code",-1),Qe=["value"],qe={class:"form-group col-sm-2"},Pe=(0,a.Lk)("label",{class:"control-label"},"Année",-1),We={id:"transfert_div",class:"row justify-content-md-center mt-2"},Ve=["disabled"],ze={key:0},He={key:1};n(2062),n(3288),n(4346),n(4782),n(8781),n(3418),n(7495),n(906);var Ge=n(2047);function Ke(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var a,o,r,i,s=[],l=!0,c=!1;try{if(r=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(a=r.call(n)).done)&&(s.push(a.value),s.length!==t);l=!0);}catch(e){c=!0,o=e}finally{try{if(!l&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(c)throw o}}return s}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return $e(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return $e(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function $e(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}const Ye={name:"Selection",props:{mode:Number},components:{AgGridVue:Ge.b},emits:["selected"],data:function(){var e=this;return{data:null,students:null,selectedRows:[],defaultColDef:{sortable:!0,filter:!0,resizable:!0,minWidth:100,editable:!1,flex:1},columnDefs:[{field:"numero",headerName:"Numero",headerCheckboxSelection:!0,checkboxSelection:!0,headerCheckboxSelectionFilteredOnly:!0,showDisabledCheckboxes:!0},{field:"name",headerName:"Nom"},{field:"surname",headerName:"Prenom"},{field:"birthday",headerName:"Date de naissance",comparator:this.dateComparator},{field:"mail",headerName:"Mail"},{headerName:"Relevé",flex:2,cellRenderer:function(t){return 0===e.mode?'<a target="_blank" href="'.concat(ke.getPreviewTmpRn(t.data.numero),'">').concat(t.data.file,"</a>"):'<a target="_blank" href="'.concat(ke.getPreviewTmpAttest(t.data.numero),'">').concat(t.data.file,"</a>")}},{headerName:"Relevé déjà existant",cellStyle:{textAlign:"center"},cellRenderer:function(t){if(-1!==t.data.index)return 0===e.mode?'<a target="_blank" href="'.concat(ke.getPreviewRn(t.data.numero,t.data.index),'">Voir</a>'):'<a target="_blank" href="'.concat(ke.getPreviewAttest(t.data.numero,t.data.index),'">Voir</a>')}}]}},methods:{dateComparator:function(e,t){var n=Ke(e.split("/").map(Number),3),a=n[0],o=n[1],r=n[2],i=Ke(t.split("/").map(Number),3),s=i[0],l=i[1],c=i[2];return new Date(r,o-1,a)-new Date(c,l-1,s)},fetchSelection:function(){var e=this;ke.getSelection(this.mode).then((function(t){e.data=t.data.data,e.students=t.data.students})).catch((function(e){console.log("fail")}))},onSelectionChanged:function(e){this.selectedRows=e.api.getSelectedRows()},OnGO:function(){confirm("En continuant, les documents sélectionnés seront transférés.")&&this.$emit("selected",this.selectedRows.map((function(e){return e.numero})),this.students,this.data)}},mounted:function(){this.fetchSelection()}},Je=(0,C.A)(Ye,[["render",function(e,t,n,o,r,i){var s=this,l=(0,a.g2)("ag-grid-vue");return(0,a.uX)(),(0,a.CE)(a.FK,null,[(0,a.Q3)("  HEADER INFO"),null!==this.data?((0,a.uX)(),(0,a.CE)("div",Te,[0===this.mode?((0,a.uX)(),(0,a.CE)("div",Fe,[Ne,(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[0]||(t[0]=function(e){return s.data.semestre=e}),class:"form-control",style:{"text-align":"center"},name:"session",type:"text",disabled:""},null,512),[[a.Jo,this.data.semestre]])])):(0,a.Q3)("v-if",!0),0===this.mode?((0,a.uX)(),(0,a.CE)("div",Me,[Ue,(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[1]||(t[1]=function(e){return s.data.session=e}),class:"form-control",style:{"text-align":"center"},type:"text",disabled:""},null,512),[[a.Jo,this.data.session]])])):(0,a.Q3)("v-if",!0),(0,a.Lk)("div",Xe,[Oe,(0,a.Lk)("input",{class:"form-control",style:{"text-align":"center"},type:"text",disabled:"",value:""===r.data.libelle?r.data.libelle_form:r.data.libelle},null,8,Ie)]),(0,a.Lk)("div",Be,[je,(0,a.Lk)("input",{class:"form-control",style:{"text-align":"center"},type:"text",disabled:"",value:""===r.data.code?r.data.code_obj:r.data.code},null,8,Qe)]),(0,a.Lk)("div",qe,[Pe,(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[2]||(t[2]=function(e){return s.data.year=e}),class:"form-control",style:{"text-align":"center"},type:"text",disabled:""},null,512),[[a.Jo,this.data.year]])])])):(0,a.Q3)("v-if",!0),(0,a.Q3)("  BUTTONS"),(0,a.Lk)("div",We,[(0,a.Lk)("button",{type:"button",class:"btn btn-primary",id:"btn_go",disabled:0===r.selectedRows.length,onClick:t[3]||(t[3]=function(){return i.OnGO&&i.OnGO.apply(i,arguments)})},[0===r.selectedRows.length?((0,a.uX)(),(0,a.CE)("span",ze,"Continuer")):((0,a.uX)(),(0,a.CE)("span",He,"Continuer ("+(0,a.v_)(this.selectedRows.length)+" / "+(0,a.v_)(this.students.length)+")",1))],8,Ve)]),(0,a.Q3)("  TABLEAU"),(0,a.bF)(l,{class:"ag-theme-alpine",style:{height:"75vh"},columnDefs:r.columnDefs,rowData:this.students,defaultColDef:r.defaultColDef,pagination:"true",suppressRowClickSelection:"true",rowSelection:"multiple",animateRows:"true",ensureDomOrder:!0,onSelectionChanged:i.onSelectionChanged,enableCellTextSelection:!0},null,8,["columnDefs","rowData","defaultColDef","onSelectionChanged"])],64)}]]);var Ze={style:{"text-align":"center"}},et={style:{display:"inline-block",margin:"0 auto"}},tt={key:0,class:"row justify-content-md-center",style:{"margin-top":"17px","margin-bottom":"17px",width:"100%"}},nt={class:"progress",style:{width:"75%",height:"35px"}},at=["aria-valuenow"],ot={key:1,class:"container",style:{width:"100%"}},rt={style:{"border-style":"outset",padding:"5px"}},it=(0,a.Fv)('<div class="row"><div class="col-2"><p>Expéditeur : </p></div><div class="col-6"><a href="mailto: noreply@uca.fr">noreply@uca.fr</a></div></div><div class="row"><div class="col-2"><p>Sujet : </p></div><div class="col-6"><p>Dépôt de document Université Clermont Auvergne</p></div></div>',2),st={class:"row"},lt=(0,a.Lk)("div",{class:"col-2"},[(0,a.Lk)("p",null,"Contenu : ")],-1),ct=["innerHTML"],ut={style:{"text-align":"center"},class:"mt-2 mb-2"},dt=(0,a.Lk)("h5",null,[(0,a.Lk)("strong",null,"Voulez-vous envoyer un mail de notification aux étudiants concernés ?")],-1),pt={class:"row justify-content-md-center"},mt={class:"col-auto"},ft={class:"col-auto"};const ht={name:"Transfert",emits:["finished"],props:{students:null,selectedRows:null,mode:Number},data:function(){return{index:0,percent:0,tranfert_done:!1,templateMail:null,nbDocToTransfert:0,numsToTransfert:null}},methods:{fetchMailTemplate:function(){var e=this;ke.fetchMailTemplate().then((function(t){e.templateMail=t.data})).catch((function(e){console.log("fail")}))},transfert:function(){var e=this;ke.transfertRn(this.numsToTransfert,this.mode).then((function(t){e.numsToTransfert=t.data,e.index=e.nbDocToTransfert-e.numsToTransfert.length,e.percent=Math.floor(e.index/e.nbDocToTransfert*100),e.numsToTransfert.length>0?e.transfert():(e.tranfert_done=!0,e.fetchMailTemplate())})).catch((function(e){alert("Une erreur est survenue lors du transfert des documents. Merci de réessayer plus tard.")}))},sendMails:function(e){var t=this;e?ke.sendMails(this.selectedRows).then((function(e){alert("Les mails ont été envoyés"),t.$emit("finished")})).catch((function(e){console.log("fail")})):this.$emit("finished")}},mounted:function(){this.nbDocToTransfert=this.selectedRows.length,this.numsToTransfert=this.selectedRows,this.transfert()}},vt=(0,C.A)(ht,[["render",function(e,t,n,o,r,i){return(0,a.uX)(),(0,a.CE)(a.FK,null,[(0,a.Lk)("div",Ze,[(0,a.Lk)("h3",et,"Transfert de "+(0,a.v_)(this.nbDocToTransfert)+" / "+(0,a.v_)(this.students.length)+" documents",1)]),r.tranfert_done?(0,a.Q3)("v-if",!0):((0,a.uX)(),(0,a.CE)("div",tt,[(0,a.Lk)("div",nt,[(0,a.Lk)("div",{class:(0,a.C4)({"progress-bar":!0,"progress-bar-striped":!0,"progress-bar-animated":!r.tranfert_done}),role:"progressbar","aria-valuenow":r.percent,"aria-valuemin":"0","aria-valuemax":"100",style:(0,a.Tr)({width:r.percent+"%",visibility:"visible",height:"35px"})},(0,a.v_)(r.percent)+"% ",15,at)])])),null!==r.templateMail?((0,a.uX)(),(0,a.CE)("div",ot,[(0,a.Lk)("div",rt,[it,(0,a.Lk)("div",st,[lt,(0,a.Lk)("div",{class:"col-6",innerHTML:r.templateMail},null,8,ct)])]),(0,a.Lk)("div",ut,[dt,(0,a.Lk)("div",pt,[(0,a.Lk)("div",mt,[(0,a.Lk)("button",{class:"btn btn-primary",onClick:t[0]||(t[0]=function(e){return i.sendMails(!0)}),type:"button"},"Oui ")]),(0,a.Lk)("div",ft,[(0,a.Lk)("button",{onClick:t[1]||(t[1]=function(e){return i.sendMails(!1)}),class:"btn btn-secondary",type:"button"},"Non ")])])])])):(0,a.Q3)("v-if",!0)],64)}]]);var bt=["src"],gt=["data"],yt=[(0,a.Lk)("p",null,"Unable to display PDF file.",-1)];n(3296),n(8408);const kt={name:"Tampon",props:{mode:Number},emits:["tamponned"],data:function(){return{tamponExample:null,dragging:!1,lastX:0,lastY:0}},methods:{WebService:function(){return ke},fetchTampon:function(){var e=this;ke.getTamponExample(this.mode).then((function(t){e.tamponExample=URL.createObjectURL(t.data)})).catch((function(e){console.log(e.response.data.error)}))},onMouseMove:function(e){if(this.dragging){var t=e.clientX-this.lastX,n=e.clientY-this.lastY,a=document.getElementById("draggable");a.style.left=a.offsetLeft+t+"px",a.style.top=a.offsetTop+n+"px",this.lastX=e.clientX,this.lastY=e.clientY}else e.preventDefault()},preventDrag:function(e){e.preventDefault()},onMouseUp:function(e){this.dragging=!1},onMouseDown:function(e){this.dragging=!0,this.lastX=e.clientX,this.lastY=e.clientY},allowDrop:function(e){e.preventDefault()},applyTampon:function(){var e=this,t=document.getElementById("pdf").getBoundingClientRect().width-48,n=document.getElementById("pdf").getBoundingClientRect().height-5-54,a=document.getElementById("pdf").getBoundingClientRect(),o=document.getElementById("draggable").getBoundingClientRect(),r=210*(o.x-a.x-24)/t,i=297*(o.y-a.y-5)/n;ke.applyTampon(r,i).then((function(t){e.$emit("tamponned")})).catch((function(e){console.log(e.response.data.error)}))}},mounted:function(){this.fetchTampon(),window.addEventListener("mousemove",this.onMouseMove),window.addEventListener("mouseup",this.onMouseUp)},beforeUnmount:function(){window.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("mouseup",this.onMouseUp)}},Lt={name:"ImportDoc",components:{Tampon:(0,C.A)(kt,[["render",function(e,t,n,o,r,i){return(0,a.uX)(),(0,a.CE)(a.FK,null,[(0,a.Lk)("img",{alt:"tampon",style:{"z-index":"1",position:"absolute"},id:"draggable",draggable:"true",onMousedown:t[0]||(t[0]=function(){return i.onMouseDown&&i.onMouseDown.apply(i,arguments)}),onDragstart:t[1]||(t[1]=function(){return i.preventDrag&&i.preventDrag.apply(i,arguments)}),src:i.WebService().getSrcTampon()+this.mode},null,40,bt),(0,a.Lk)("button",{class:"btn btn-primary mb-2",type:"button",onClick:t[2]||(t[2]=function(){return i.applyTampon&&i.applyTampon.apply(i,arguments)})},"Appliquer le tampon"),(0,a.Lk)("object",{onDragover:t[3]||(t[3]=function(){return i.allowDrop&&i.allowDrop.apply(i,arguments)}),id:"pdf",data:r.tamponExample+"#zoom=100&pagemode=none&scrollbar=0&toolbar=0&statusbar=1&messages=0&navpanes=0",type:"application/pdf",width:"840px",height:"1180px"},yt,40,gt)],64)}]]),Transfert:vt,Selection:Je,Truncate:Ae,Import:we},props:{mode:Number},data:function(){return{step:0,importData:null,students:null,selectedRows:null}},methods:{onDataImported:function(e){this.importData=e,this.importData.sameParams&&alert("Les paramètres correspondent à un dépôt existant"),"tampon"===this.importData.step?this.step=1:this.step=2},onDataTruncated:function(){this.step=3},onSelected:function(e,t,n){this.step=4,this.students=t,this.selectedRows=e},onTamponned:function(){this.step=2},onTransfertFinished:function(){this.step=5,0===this.mode?this.$router.push({path:"/scola/monitoring/rn"}):1===this.mode&&this.$router.push({path:"/scola/monitoring/attest"})}},beforeRouteLeave:function(e,t,n){this.step>0&&5!==this.step?confirm("Voulez-vous vraiment quitter cette page ?")?n():n(!1):n()},mounted:function(){},watch:{mode:function(){this.step=0}}},St=(0,C.A)(Lt,[["render",function(e,t,n,o,r,i){var s=(0,a.g2)("Import"),l=(0,a.g2)("Tampon"),c=(0,a.g2)("Truncate"),u=(0,a.g2)("Selection"),d=(0,a.g2)("Transfert");return(0,a.uX)(),(0,a.CE)(a.FK,null,[(0,a.Lk)("div",W,[(0,a.Lk)("nav",V,[(0,a.Lk)("ol",z,[(0,a.Lk)("li",{class:(0,a.C4)(["breadcrumb-item active",{"text-primary":0===r.step,"fw-bold":0===r.step}]),"aria-current":"page"},"Import ",2),(0,a.Lk)("li",{class:(0,a.C4)(["breadcrumb-item active",{"text-primary":1===r.step,"fw-bold":1===r.step}]),"aria-current":"page"},"Tamponnage ",2),(0,a.Lk)("li",{class:(0,a.C4)(["breadcrumb-item active",{"text-primary":2===r.step,"fw-bold":2===r.step}]),"aria-current":"page"},"Découpage ",2),(0,a.Lk)("li",{class:(0,a.C4)(["breadcrumb-item active",{"text-primary":3===r.step,"fw-bold":3===r.step}]),"aria-current":"page"},"Sélection ",2),(0,a.Lk)("li",{class:(0,a.C4)(["breadcrumb-item active",{"text-primary":4===r.step,"fw-bold":4===r.step}]),"aria-current":"page"},"Transfert ",2)])])]),(0,a.Lk)("div",{class:(0,a.C4)({container:2!==r.step,"container-fluid":2===r.step})},[0===r.step?((0,a.uX)(),(0,a.Wv)(s,{key:0,mode:n.mode,onImported:i.onDataImported},null,8,["mode","onImported"])):(0,a.Q3)("v-if",!0),1===r.step?((0,a.uX)(),(0,a.Wv)(l,{key:1,mode:n.mode,onTamponned:i.onTamponned},null,8,["mode","onTamponned"])):(0,a.Q3)("v-if",!0),2===r.step?((0,a.uX)(),(0,a.Wv)(c,{key:2,mode:n.mode,"page-count":this.importData.pageCount,"page-index":this.importData.pageFirst,onTruncated:i.onDataTruncated},null,8,["mode","page-count","page-index","onTruncated"])):(0,a.Q3)("v-if",!0),3===r.step?((0,a.uX)(),(0,a.Wv)(u,{key:3,mode:n.mode,onSelected:i.onSelected},null,8,["mode","onSelected"])):(0,a.Q3)("v-if",!0),4===r.step?((0,a.uX)(),(0,a.Wv)(d,{key:4,mode:n.mode,students:this.students,selectedRows:this.selectedRows,onFinished:i.onTransfertFinished},null,8,["mode","students","selectedRows","onFinished"])):(0,a.Q3)("v-if",!0)],2)],64)}]]);var Ct={class:"container-fluid"},wt={class:"modal fade",id:"historiqueModal",tabindex:"-1","aria-labelledby":"historiqueModalLabel","aria-hidden":"true"},xt={class:"modal-dialog modal-xl"},Dt={class:"modal-content"},_t=(0,a.Lk)("div",{class:"modal-header"},[(0,a.Lk)("h1",{class:"modal-title fs-5",id:"historiqueModalLabel"},"Historique"),(0,a.Lk)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Et={class:"modal-body"},Rt=(0,a.Lk)("div",{class:"modal-footer"},[(0,a.Lk)("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Fermer")],-1),At={class:"modal fade",id:"suppressionModal",tabindex:"-1","aria-labelledby":"suppressionModalLabel","aria-hidden":"true"},Tt={class:"modal-dialog modal-xl"},Ft={class:"modal-content"},Nt=(0,a.Lk)("div",{class:"modal-header"},[(0,a.Lk)("h1",{class:"modal-title fs-5",id:"suppressionModalLabel"},"Suppression de documents"),(0,a.Lk)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Mt={class:"modal-body"},Ut=(0,a.Lk)("div",{class:"alert alert-warning"},"La suppression est définitive, les étudiants n'auront plus accès aux documents ",-1),Xt={class:"modal-footer"},Ot=(0,a.Lk)("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Fermer",-1),It=["disabled"],Bt={key:0,class:"text-center"},jt={key:1,class:"text-center"};n(5440),n(2762),n(8980);function Qt(e){return function(e){if(Array.isArray(e))return qt(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return qt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return qt(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function qt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var Pt={template:'<button data-bs-toggle="modal" :data-bs-target="this.params.modal" data-bs-backdrop="true" class="btn btn-outline-secondary mt-1"\n                style="height: 30px;width: 15px" v-on:click="this.params.onClicked(this.params.data)">\n                    <span :class="this.params.txt"></span>\n             </button>'},Wt={template:'<button style="height: 30px;width: 15px" class="btn btn-outline-secondary mt-1" v-on:click="this.params.onClicked(this.params.data)">\n                 <span :class="this.params.txt"></span>\n            </button>'};const Vt={name:"MonitoringDoc",props:{mode:Number},components:{AgGridVue:Ge.b},data:function(){return{selected:null,selectedDeleteRows:null,files:null,monitoring:null,defaultColDef:{floatingFilter:!0,sortable:!0,filter:!0,resizable:!0,minWidth:100,editable:!1,flex:1},autoSizeStrategy:{type:"fitCellContents",skipHeader:!1},columnDefs:this.getColDefs(),columnHistorique:[{field:"formattedDate",headerName:"Date"},{headerName:"Nombre de fichiers",valueGetter:function(e){return e.data.nb_files>0?"+"+e.data.nb_files:e.data.nb_files}},{headerName:"Action",editable:!1,valueGetter:function(e){return 1===e.data.state?"Dépot initial":2===e.data.state?"Dépot supplémentaire":3===e.data.state?"Suppression":"Erreur"}}],columnEdit:[{headerName:"Fichier",field:"file",headerCheckboxSelection:!0,checkboxSelection:!0,headerCheckboxSelectionFilteredOnly:!0,showDisabledCheckboxes:!0},{field:"codeEtu",headerName:"Numéro étudiant"},{field:"nom",headerName:"Nom"},{field:"prenom",headerName:"Prénom"}]}},methods:{onCellFocused:function(e){6===e.column.getColId()&&(e.api.deselectAll(),e.api.clearFocusCell())},getColDefs:function(){var e=this;return[{field:"username",headerName:"Utilisateur",hide:!L.isAdmin()},{headerName:"Date de traitement",valueGetter:function(e){return e.data.history.slice(-1)[0].formattedDate}},{headerName:0===this.mode?"Année universitaire / Session / Semestre":"Année universitaire",valueGetter:function(t){return 0===e.mode?t.data.year+" / "+t.data.session+" / "+t.data.semestre:t.data.year}},{headerName:"Code",valueGetter:function(e){return e.data.type+" / "+e.data.code_obj+" / "+e.data.code}},{headerName:"Libellé",valueGetter:function(t){return 0===e.mode?t.data.libelle_form+" / "+t.data.libelle:t.data.libelle_obj+" / "+t.data.libelle}},{headerName:"Nombre de transferts",cellClass:"text-center",valueGetter:function(e){return e.data.nb_students}},{headerName:"Historique",floatingFilter:!1,cellRenderer:Pt,cellClassRules:{"non-selectable":!0},cellRendererParams:{onClicked:function(t){return e.selected=t},txt:"mdi mdi-history mdi-24px",modal:"#historiqueModal"}},{headerName:"Fichiers",floatingFilter:!1,cellRenderer:Pt,cellRendererParams:{onClicked:function(t){e.selected=t,e.files=[],e.fetchFiles(t.id)},txt:"mdi mdi-file-remove mdi-24px",modal:"#suppressionModal"}},{headerName:"Reconstruction",floatingFilter:!1,cellRenderer:Wt,cellRendererParams:{onClicked:function(t){return e.rebuildDoc(t)},txt:"mdi mdi-file-multiple mdi-24px"}}]},rebuildDoc:function(e){Se("Reconstruction en cours...","short_success"),ke.rebuild(e.id).then((function(e){Se("Reconstruction finie","short_success");var t=e.headers["content-disposition"].split(";")[1].split("=")[1].trim().replace(/"/g,""),n=URL.createObjectURL(e.data),a=document.createElement("a");a.href=n,a.download=t,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(n)})).catch((function(e){Se("Reconstruction fail","short_error")}))},fetchRnMonitoring:function(){var e=this;ke.getMonitoring(this.mode).then((function(t){e.monitoring=t.data})).catch((function(e){console.log(e),Se("Erreur lors de la récupération des données","short_error")}))},fetchFiles:function(e){var t=this;ke.fetchRnFiles(e).then((function(e){t.files=e.data})).catch((function(e){console.log(e),alert("Erreur lors de la récupération des données")}))},removeFiles:function(){var e=this;if(null!==this.selectedDeleteRows&&0!==this.selectedDeleteRows.length&&confirm("Voulez-vous vraiment supprimer "+this.selectedDeleteRows.length+" document(s) ?")){var t=this.selectedDeleteRows.map((function(e){return e.codeEtu}));ke.removeFiles(this.selected.id,t).then((function(n){var a=document.querySelector("#suppressionModal");bootstrap.Modal.getOrCreateInstance(a).hide();var o=e.monitoring.findIndex((function(e){return e.id===n.data.id}));-1!==o&&(e.monitoring=[].concat(Qt(e.monitoring.slice(0,o)),[n.data],Qt(e.monitoring.slice(o+1)))),Se(t.length+" fichier(s) supprimé(s)","short_success")})).catch((function(e){console.log(e)}))}},onSelectionDeleteChanged:function(e){this.selectedDeleteRows=e.api.getSelectedRows()}},beforeMount:function(){this.fetchRnMonitoring()},mounted:function(){},beforeRouteLeave:function(e,t,n){var a=document.querySelector("#suppressionModal");bootstrap.Modal.getOrCreateInstance(a).hide();var o=document.querySelector("#historiqueModal");bootstrap.Modal.getOrCreateInstance(o).hide(),n()},watch:{mode:function(){this.columnDefs=this.getColDefs(),this.monitoring=[],this.fetchRnMonitoring()}}},zt=(0,C.A)(Vt,[["render",function(e,t,n,o,r,i){var s=(0,a.g2)("ag-grid-vue");return(0,a.uX)(),(0,a.CE)("div",Ct,[(0,a.Q3)(" Historique Modal "),(0,a.Lk)("div",wt,[(0,a.Lk)("div",xt,[(0,a.Lk)("div",Dt,[_t,(0,a.Lk)("div",Et,[null!==this.selected?((0,a.uX)(),(0,a.Wv)(s,{key:0,class:"ag-theme-alpine",style:{height:"40vh"},columnDefs:r.columnHistorique,rowData:this.selected.history,defaultColDef:r.defaultColDef,pagination:"true",animateRows:"true",ensureDomOrder:!0,enableCellTextSelection:!0},null,8,["columnDefs","rowData","defaultColDef"])):(0,a.Q3)("v-if",!0)]),Rt])])]),(0,a.Q3)(" Suppression Modal "),(0,a.Lk)("div",At,[(0,a.Lk)("div",Tt,[(0,a.Lk)("div",Ft,[Nt,(0,a.Lk)("div",Mt,[Ut,null!==this.selected?((0,a.uX)(),(0,a.Wv)(s,{key:0,class:"ag-theme-alpine",style:{height:"60vh"},columnDefs:r.columnEdit,rowData:this.files,defaultColDef:r.defaultColDef,onSelectionChanged:i.onSelectionDeleteChanged,rowSelection:"multiple",pagination:"true",animateRows:"true",ensureDomOrder:!0,enableCellTextSelection:!0},null,8,["columnDefs","rowData","defaultColDef","onSelectionChanged"])):(0,a.Q3)("v-if",!0)]),(0,a.Lk)("div",Xt,[Ot,(0,a.Lk)("button",{type:"button",class:"btn btn-primary",onClick:t[0]||(t[0]=function(){return i.removeFiles&&i.removeFiles.apply(i,arguments)}),disabled:null===this.selectedDeleteRows||0===this.selectedDeleteRows.length},"Supprimer les documents ",8,It)])])])]),0===this.mode?((0,a.uX)(),(0,a.CE)("h3",Bt,"Suivi des Relevés de notes")):(0,a.Q3)("v-if",!0),1===this.mode?((0,a.uX)(),(0,a.CE)("h3",jt,"Suivi des Attestations de réussite")):(0,a.Q3)("v-if",!0),(0,a.bF)(s,{class:"ag-theme-alpine",style:{height:"85vh"},columnDefs:r.columnDefs,rowData:r.monitoring,defaultColDef:r.defaultColDef,pagination:"true",animateRows:"true",ensureDomOrder:!0,onCellFocused:i.onCellFocused,localeText:{noRowsToShow:"Aucune donnée à afficher"},enableCellTextSelection:!0},null,8,["columnDefs","rowData","defaultColDef","onCellFocused"])])}]]);var Ht={class:"container"},Gt=(0,a.Lk)("div",{class:"row justify-content-md-center"},[(0,a.Lk)("h3",null,"Rechercher les documents d'un étudiant")],-1),Kt={class:"mt-3"},$t={class:"mb-3"},Yt=(0,a.Lk)("label",{for:"searchFieldInput",class:"form-label"},"Nom ou code étudiant",-1),Jt={class:"mb-3"},Zt=["disabled"],en={class:"ag-theme-alpine"};const tn={name:"agNavLink",data:function(){return{toPath:"/",toName:""}},mounted:function(){this.toPath="/student/".concat(this.params.data.CLFDcodeEtu),this.toName=this.params.data.CLFDcodeEtu}},nn=(0,C.A)(tn,[["render",function(e,t,n,o,r,i){var s=(0,a.g2)("router-link");return(0,a.uX)(),(0,a.Wv)(s,{to:r.toPath},{default:(0,a.k6)((function(){return[(0,a.eW)((0,a.v_)(r.toName),1)]})),_:1},8,["to"])}]]),an={name:"SearchStudent",components:{AgGridVue:Ge.b},data:function(){return{searchField:"",students:null,defaultColDef:{floatingFilter:!0,sortable:!0,filter:!0,resizable:!0,minWidth:100,editable:!1,flex:1},columnDefs:[{field:"CLFDcodeEtu",headerName:"Numéro",cellRenderer:nn},{field:"sn",headerName:"Nom"},{field:"givenName",headerName:"Prénom"},{field:"supannEntiteAffectationPrincipale",headerName:"Composante"},{field:"nb_docs",headerName:"Nombre de documents"}]}},methods:{searchStudent:function(){var e=this;ke.searchStudent(this.searchField).then((function(t){e.students=t.data})).catch((function(e){console.log(e)}))}}},on=(0,C.A)(an,[["render",function(e,t,n,o,r,i){var s=(0,a.g2)("ag-grid-vue");return(0,a.uX)(),(0,a.CE)("div",Ht,[Gt,(0,a.Lk)("div",Kt,[(0,a.Lk)("div",$t,[Yt,(0,a.bo)((0,a.Lk)("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=function(e){return r.searchField=e}),onKeyup:t[1]||(t[1]=(0,a.jR)((function(){return i.searchStudent&&i.searchStudent.apply(i,arguments)}),["enter"])),class:"form-control",id:"searchFieldInput",placeholder:"Dupont | 2320215210"},null,544),[[a.Jo,r.searchField]])]),(0,a.Lk)("div",Jt,[(0,a.Lk)("button",{class:"btn btn-primary",type:"button",onClick:t[2]||(t[2]=function(){return i.searchStudent&&i.searchStudent.apply(i,arguments)}),disabled:""===r.searchField},"Rechercher ",8,Zt)])]),(0,a.Lk)("div",en,[null!==r.students?((0,a.uX)(),(0,a.Wv)(s,{key:0,class:"ag-theme-alpine",style:{height:"60vh"},columnDefs:r.columnDefs,rowData:r.students,defaultColDef:r.defaultColDef,pagination:"true",animateRows:"true",ensureDomOrder:!0,enableCellTextSelection:!0},null,8,["columnDefs","rowData","defaultColDef"])):(0,a.Q3)("v-if",!0)])])}]]);n(4490);var rn={key:0,class:"container-lg"},sn={class:"mt-2 mb-2 row"},ln=(0,a.Lk)("h4",null,"Documents de scolarité",-1),cn={class:"accordion",id:"accordionPanelsStayOpenExample"},un={class:"accordion-item mt-2"},dn=["id"],pn=["data-bs-target","aria-expanded","aria-controls"],mn=["id","aria-labelledby"],fn={class:"accordion-body"},hn={class:"row"},vn=(0,a.Lk)("h6",null,[(0,a.Lk)("strong",null,"Relevés de notes")],-1),bn=["href"],gn=(0,a.Lk)("h6",null,[(0,a.Lk)("strong",null,"Attestations de réussite")],-1),yn=["href"],kn={key:1,class:"container"},Ln={class:"mt-2 mb-2 row"},Sn=(0,a.Lk)("h4",null,"Documents de scolarité",-1),Cn={key:0},wn=(0,a.Lk)("div",{class:"alert alert-warning m-5 text-center"},"Aucun document vous concernant n'a été déposé par votre service scolarité",-1);const xn={name:"StudentView",data:function(){return{docs:null,num:0}},methods:{WebService:function(){return ke},fetchDocs:function(){var e=this;ke.getStudentDocs(this.num).then((function(t){e.docs=t.data})).catch((function(e){console.log("Error fetching docs")}))}},mounted:function(){L.isEtudiant()?this.num=L.numero:this.num=this.$route.params.num,this.fetchDocs()}},Dn=(0,C.A)(xn,[["render",function(e,t,n,o,r,i){var s=this;return null!==this.docs&&Object.keys(r.docs.data).length>0?((0,a.uX)(),(0,a.CE)("div",rn,[(0,a.Lk)("div",sn,[ln,(0,a.Lk)("h5",null,(0,a.v_)(this.docs.student.nom)+" "+(0,a.v_)(this.docs.student.prenom)+" ("+(0,a.v_)(this.docs.student.numero)+")",1)]),(0,a.Lk)("div",cn,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(Object.keys(r.docs.data).reverse(),(function(e,t){return(0,a.uX)(),(0,a.CE)("div",un,[(0,a.Lk)("h2",{class:"accordion-header",id:"panelsStayOpen-heading"+e},[(0,a.Lk)("button",{class:(0,a.C4)("accordion-button"+(t>0?" collapsed":"")),type:"button","data-bs-toggle":"collapse","data-bs-target":"#panelsStayOpen-collapse"+e,"aria-expanded":0===t,"aria-controls":"panelsStayOpen-collapse"+e},(0,a.v_)(e),11,pn)],8,dn),(0,a.Lk)("div",{id:"panelsStayOpen-collapse"+e,class:(0,a.C4)("accordion-collapse collapse"+(0===t?" show":"")),"aria-labelledby":"panelsStayOpen-heading"+e},[(0,a.Lk)("div",fn,[(0,a.Lk)("div",hn,[(0,a.Lk)("div",{class:(0,a.C4)("col-12 col-lg-6 "+(void 0===r.docs.data[e].rn?"collapse":""))},[vn,(0,a.Lk)("ul",null,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(r.docs.data[e].rn,(function(e){return(0,a.uX)(),(0,a.CE)("li",null,[(0,a.Lk)("a",{href:i.WebService().getDownloadURL(0)+s.num+"/"+e.index,target:"_blank"},(0,a.v_)(e.name),9,bn)])})),256))])],2),(0,a.Lk)("div",{class:(0,a.C4)("col-12 col-lg-6 "+(void 0===r.docs.data[e].attest?"collapse":""))},[gn,(0,a.Lk)("ul",null,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(r.docs.data[e].attest,(function(e){return(0,a.uX)(),(0,a.CE)("li",null,[(0,a.Lk)("a",{href:i.WebService().getDownloadURL(1)+s.num+"/"+e.index,target:"_blank"},(0,a.v_)(e.name),9,yn)])})),256))])],2)])])],10,mn)])})),256))])])):((0,a.uX)(),(0,a.CE)("div",kn,[(0,a.Lk)("div",Ln,[Sn,null!==this.docs?((0,a.uX)(),(0,a.CE)("h5",Cn,(0,a.v_)(this.docs.student.nom)+" "+(0,a.v_)(this.docs.student.prenom)+" ("+(0,a.v_)(this.docs.student.numero)+")",1)):(0,a.Q3)("v-if",!0)]),wn]))}]]);var _n={class:"container mt-2"},En=[(0,a.Lk)("div",{class:"row justify-content-md-center alert alert-warning"},[(0,a.Lk)("h5",{style:{"text-align":"center"}},"Vous n'avez pas accès à cette application")],-1)];const Rn={name:"Unauthorized"},An=(0,C.A)(Rn,[["render",function(e,t,n,o,r,i){return(0,a.uX)(),(0,a.CE)("div",_n,En)}]]);var Tn=document.querySelector("#app").dataset.info,Fn=JSON.parse(atob(Tn));L.setName(Fn.username),L.setRoles(Fn.roles),L.setEncryptedName(Fn.encryptedUsername),L.setNumero(Fn.numero);var Nn=[{path:"/scola",component:P,meta:{requiresScola:!0}},{path:"/scola/import/rn",component:St,meta:{requiresScola:!0},props:{mode:0}},{path:"/scola/import/attest",component:St,meta:{requiresScola:!0},props:{mode:1}},{path:"/scola/monitoring/rn",component:zt,meta:{requiresScola:!0},props:{mode:0}},{path:"/scola/monitoring/attest",component:zt,meta:{requiresScola:!0},props:{mode:1}},{path:"/scola/search",component:on,meta:{requiresScola:!0}},{path:"/student/:num*",component:Dn,meta:{requiresScola:!1}},{path:"/unauthorized",component:An,meta:{requiresScola:!1}},{path:"/:pathMatch(.*)*",redirect:"/scola"}],Mn=(0,D.aE)({history:(0,D.LA)(),routes:Nn});ve.A.interceptors.response.use((function(e){return e}),(function(e){return console.log("AXIOS ERR"),Promise.reject(e)})),Mn.beforeEach((function(e,t,n){L.isEtudiant()&&"/student"!==e.path?n({path:"/student"}):L.isAnonym()&&"/unauthorized"!==e.path?n({path:"/unauthorized"}):L.isAnonym()||"/unauthorized"!==e.path?e.meta.requiresScola?L.isScola()?n():n({path:"/"}):n():n({path:"/"})}));var Un=(0,a.Ef)(x,{url_login:Fn.url_login,url_logout:Fn.url_logout});Un.config.compilerOptions.isCustomElement=function(e){return e.startsWith("uca-")},Un.use(Mn).mount("#app")}},e=>{e.O(0,[178],(()=>{return t=4991,e(e.s=t);var t}));e.O()}]);